var spiner=createSpinner();var background=document.getElementById("background");
var spinerShow=function(){background.style.display="block";spiner.spin(background)};
var spinerHide=function(){background.style.display="none";spiner.stop()};
var addCartWare=function(h,d,g,c,f,e,b){var a="/cart/add.json?wareId="+h+"&num="+d+"&sid="+$("#sid").val();a=appendSuit(a,g,c,f,e,b);spinerShow();jQuery.get(a,{},function(i){calcCartCheck(i,h);calcCartGifts(i,h)})};
var modifyWare=function(b,e,a,h,c,i,d){
	var g;
	if((!isBlank(a)&&a!=4)){
		g=$("#num"+h).val()
	}else{
		g=$("#num"+b).val()
	}
	if(!/^\d+$/.test(g)){
		alert("\u5546\u54c1\u6570\u91cf\u4fee\u6539\u5931\u8d25");
		return
	}
	if(Number(g)>1000){
		alert("\u5546\u54c1\u6570\u91cf\u4fee\u6539\u5931\u8d25");
		if((!isBlank(a)&&a!=4)){
			$("#num"+h).val(1000)
		}else{
			$("#num"+b).val(1000)
		}
	}
	if(Number(g)<1){
		alert("\u5546\u54c1\u6570\u91cf\u4fee\u6539\u5931\u8d25");
		$("#num"+b).val(1);
		if((!isBlank(a)&&a!=4)){
			$("#num"+h).val(1000)
		}else{
			$("#num"+b).val(1)
		}
	}
	$("#numerror"+b).text("");
	if(isBlank(e)||(!isBlank(a)&&a==4)){
		e=$("#num"+b).val()
	}else{
		c=$("#num"+h).val()
	}
	var f="/cart/modify.json?wareId="+b+"&num="+e+"&sid="+$("#sid").val();
	f=appendSuit(f,a,h,c,i,d);
	spinerShow();
	jQuery.get(f,{},function(j){
		calcCartCheck(j,b);
		calcCartGifts(j,b);
		$("span[name='suitSkuNum"+b+"']").text(g)
	})
};
var deleteWare=function(h,c,g,b,f,e,d){if(confirm("\u786e\u5b9a\u5220\u9664\u5417\uff1f")){var a="/cart/remove.json?wareId="+h+"&num="+c+"&sid="+$("#sid").val();a=appendSuit(a,g,b,f,e);spinerShow();jQuery.get(a,{},function(i){calcCartCheck(i,h);calcCartGifts(i,h);if(d!="gift"){$("#product"+h).hide()}})}};var showChooseGifts=function(b,g,e,f,d,c){if(b=="0"){var a="/cart/check.json?wareId="+g+"&num="+$("#num"+g).val()+"&checked=5&sid="+$("#sid").val();a=appendSuit(a,f,d,c);spinerShow();jQuery.get(a,{},function(h){calcCartCheck(h,g);document.getElementById("giftWares").innerHTML=document.getElementById("chooseGifts"+g).innerHTML;document.getElementById("giftWares").style.top=(document.documentElement.scrollTop||document.body.scrollTop)+10+"px"})}else{document.getElementById("giftWares").innerHTML=document.getElementById("chooseGifts"+g).innerHTML;document.getElementById("giftWares").style.display="block";document.getElementById("giftWares").style.top=(document.documentElement.scrollTop||document.body.scrollTop)+10+"px"}};var hideChooseGifts=function(a){document.getElementById("background").style.display="none";document.getElementById("giftWares").style.display="none"};var showChooseYanBao=function(a){document.getElementById("background").style.display="block";document.getElementById("chooseYanBao"+a).style.display="block"};var hideChooseYanBao=function(a){document.getElementById("background").style.display="none";document.getElementById("chooseYanBao"+a).style.display="none"};var addGifts=function(d,c,e,b,a){hideChooseGifts(d);addCartWare(d,c,e,b,a)};var deleteGifts=function(d,c,e,b,a){deleteWare(d,c,e,b,a,"","gift")};var addYanBao=function(e,d,f,b,a,c){hideChooseYanBao(e);addCartWare(e,d,f,b,a,c)};var deleteYanBao=function(g,f,h,c,b,e,d){if(confirm("\u786e\u5b9a\u5220\u9664\u5417\uff1f")){var a="/cart/removeYB.json?wareId="+g+"&num="+f+"&sid="+$("#sid").val();a=appendSuit(a,h,c,b,e,d);spinerShow();jQuery.get(a,{},function(i){calcCartCheck(i,g);calcCartGifts(i,g);$("#yanbao"+e).hide()})}};var keydown=function(a){$("#"+a).addClass("checked")};var changeSelected=function(h,d,g,c,b){var f=6;var e=h;if(g==undefined||g==4){e=h}else{e=c}if($("#checkIcon"+e).hasClass("checked")){$("#checkIcon"+e).removeClass("checked")}else{$("#checkIcon"+e).addClass("checked");f=5}var a="/cart/check.json?wareId="+h+"&num="+d+"&checked="+f+"&sid="+$("#sid").val();a=appendSuit(a,g,c,b);spinerShow();jQuery.get(a,{},function(i){if(i!=undefined){calcCartCheck(i,h);calcCartGifts(i,h);spinerHide()}else{if($("#checkIcon"+h).hasClass("checked")){$("#checkIcon"+h).removeClass("checked")}else{$("#checkIcon"+h).addClass("checked")}}})};var calcCartCheck=function(m,a){try{if(!isBlank(m.cart)){m=m.cart;var d=m.Price-m.Discount;var b=d-m.RePrice;document.getElementById("cart_oriPrice").innerHTML=d.toFixed(2);document.getElementById("cart_rePrice").innerHTML=m.RePrice.toFixed(2);document.getElementById("cart_realPrice").innerHTML=b.toFixed(2);document.getElementById("checkedNum").innerHTML=m.checkedWareNum;var k=m.Skus;for(var g=0;g<k.length;g++){var l=k[g];if(l.Id==(a==-1?l.Id:a)){if(l.CheckType==1){$("#checkIcon"+(a==-1?l.Id:a)).addClass("checked")}else{$("#checkIcon"+(a==-1?l.Id:a)).removeClass("checked")}}}k=m.Gifts;for(var g=0;g<k.length;g++){var f=k[g];if(f.Id==(a==-1?f.Id:a)){if(f.MainSku.CheckType==1){$("#checkIcon"+(a==-1?f.MainSku.Id:a)).addClass("checked")}else{$("#checkIcon"+(a==-1?f.MainSku.Id:a)).removeClass("checked")}}}k=m.Suits;for(var g=0;g<k.length;g++){var n=k[g];if(n.Id==(a==-1?n.Id:a)){if(n.SType==4){if(n.CheckType==1){$("#checkIcon"+(a==-1?n.Id:a)).addClass("checked")}else{$("#checkIcon"+(a==-1?n.Id:a)).removeClass("checked")}}else{for(var c=0;c<n.Skus.length;c++){var l=n.Skus[c];if(l.CheckType==1){$("#checkIcon"+l.Id).addClass("checked")}else{$("#checkIcon"+l.Id).removeClass("checked")}}}}}if(m.Num==m.checkedWareNum){$("#checkIcon-1").addClass("checked")}else{$("#checkIcon-1").removeClass("checked")}judgeSubmit(b)}else{$("#notEmptyCart").hide();$("#emptyCart").show()}}catch(h){alert(h)}spinerHide()};var calcCartGifts=function(p,b){try{if(!isBlank(p.cart)){p=p.cart;var f=p.Price-p.Discount;var c=f-p.RePrice;document.getElementById("cart_oriPrice").innerHTML=f.toFixed(2);document.getElementById("cart_rePrice").innerHTML=p.RePrice.toFixed(2);document.getElementById("cart_realPrice").innerHTML=c.toFixed(2);document.getElementById("checkedNum").innerHTML=p.checkedWareNum;var n=p.Skus;for(var k=0;k<n.length;k++){var o=n[k];if(o.Id==(b==-1?o.Id:b)){}}n=p.Gifts;for(var k=0;k<n.length;k++){var h=n[k];if(h.Id==(b==-1?h.Id:b)){}}n=p.Suits;for(var k=0;k<n.length;k++){var q=n[k];if(q.Id==(b==-1?q.Id:b)){if(!!q.STip){if(q.STip.indexOf("\u9886\u53d6\u8d60\u54c1")!=-1&&q.STip.indexOf("\u5148\u5230\u5148\u5f97")==-1){$("#sTip"+q.Id).html(q.STip.substr(0,q.STip.indexOf("\u9886\u53d6\u8d60\u54c1")))}else{$("#sTip"+q.Id).html(q.STip)}if(q.RePrice>0){$("#sTip"+q.Id).css("color","#7abd54")}else{$("#sTip"+q.Id).css("color","#db2929")}}if(q.SType==4){}else{var a="";for(var d=0;d<q.Gifts.length;d++){var l=q.Gifts[d];a+='<span class="p-num gray">[\u8d60\u54c1] '+l.Name+" x "+l.Num+' </span><a href="javascript:deleteGifts('+q.Id+","+q.Num+","+q.SType+","+l.Id+","+l.Num+')" class="link">\u5220\u9664</a>'}$("#givenGift"+q.Id).html(a);if(q.CanSelectGifts.length>0){makeChooseGift(q.Id,q.Num,q.SType,q.CheckType,q.CanSelectGifts)}if(q.CanSelectGifts.length>=1){$("#notGivenGift"+q.Id).show()}else{$("#notGivenGift"+q.Id).hide()}$("span[name='optionsGift']").removeClass("checked")}}}judgeSubmit(c)}else{$("#notEmptyCart").hide();$("#emptyCart").show()}}catch(m){alert(m)}spinerHide()};var makeChooseGift=function(c,h,a,b,g){var l='<div class="pop-head">\u9009\u62e9\u8d60\u54c1<a href="javascript:hideChooseGifts(\''+c+'\')" class="btn-close"><span></span></a></div><div class="pop-list"><ul class="list">';var k="";for(var e=0;e<g.length;e++){var d=g[e];k+='<li class="" onclick="javascript:addGifts(\''+c+"','"+h+"','"+a+"','"+d.Id+"','"+d.Num+"')\" onmousedown=\"keydown('pressGift"+d.Id+'\')"><div class="goods-info"><span name="optionsGift" class="cart-checkbox" top="25px" id="pressGift'+d.Id+'"></span><img class="photo" src="http://img10.360buyimg.com/n5/'+d.ImgUrl+'" width="50" height="50" alt="img"/><div class="desc"><span class="title title-v1">\u3010\u8d60\u54c1\u3011'+d.Name+' </span><span class="num-price">x'+d.Num+' <span class="price-txt">\uffe5'+d.Price+"</span></span></div></div></li>"}var j="</ul></div>";var f=l+k+j;$("#chooseGifts"+c).html(f)};var disableSubmit=function(){$("#submit").css("background","#999");$("#submit").click("")};var enableSubmit=function(){$("#submit").css("background","#c00000");$("#submit").click(submit)};var judgeSubmit=function(a){if(Number(a)<=0){disableSubmit();$("#checkAll").removeClass("checked")}else{enableSubmit()}};var appendSuit=function(e,f,b,d,c,a){if(!isBlank(e)){if(!isBlank(f)){e+="&sType="+f}if(!isBlank(b)){e+="&suitSkuId="+b}if(!isBlank(d)){e+="&suitSkuNum="+d}if(!isBlank(c)){e+="&ybId="+c}if(!isBlank(a)){e+="&ybNum="+a}}return e};var submit=function(){var a=$("#newOrderServer").val();var b=document.getElementById("cart_realPrice").innerHTML;if(Number(b)<=0){return}if(Number($("#cartNum").val())>Number($("#limitCartNum").val())){alert("\u5546\u54c1\u79cd\u7c7b\u4e0d\u80fd\u5927\u4e8e"+$("#limitCartNum").val());return}if(a=="true"){location.href="/norder/order.action?enterOrder=true&sid="+$("#sid").val()}else{location.href="/order/order.action?enterOrder=true&yys=false&from=0&sid="+$("#sid").val()}};var isBlank=function(a){if(a==undefined||a==null||a.length==0){return true}else{return false}};var deSelectedAll=function(){var b=-1;$("#checkIcon"+b).removeClass("checked");spinerShow();var a="/cart/check.json?checked="+8+"&sid="+$("#sid").val();jQuery.get(a,{},function(c){if(c!=undefined){calcCartCheck(c,b);calcCartGifts(c,b);spinerHide()}else{if($("#checkIcon"+b).hasClass("checked")){$("#checkIcon"+b).removeClass("checked")}else{$("#checkIcon"+b).addClass("checked")}}})};var selectedAll=function(){var b=-1;$("#checkIcon"+b).addClass("checked");spinerShow();var a="/cart/check.json?checked="+7+"&sid="+$("#sid").val();jQuery.get(a,{},function(c){if(c!=undefined){calcCartCheck(c,b);calcCartGifts(c,b);spinerHide()}else{if($("#checkIcon"+b).hasClass("checked")){$("#checkIcon"+b).removeClass("checked")}else{$("#checkIcon"+b).addClass("checked")}}})};var checkAllHandler=function(){if($("#checkIcon-1").hasClass("checked")){$("#checkIcon-1").removeClass("checked ");deSelectedAll()}else{$("#checkIcon-1").addClass("checked");selectedAll()}};var setFixTip=function(b,a){window.onscroll=function(){var d=document.documentElement.scrollTop||document.body.scrollTop;var c=$("#"+a).offset().top;if(d>=c-10){$("#"+b+"p").css("height",$("#"+b).height());$("#"+b).css("position","fixed");$("#"+b).css("z-index","10001");$("#"+b).css("top","0px");$("#"+b).css("border-bottom","1px solid #e4393c")}else{$("#"+b+"p").css("height","0px");$("#"+b).css("position","");$("#"+b).css("z-index","");$("#"+b).css("border-bottom","0px solid #e4393c");$("#"+b).css("top",$("#"+a).offset().top+"px")}}};