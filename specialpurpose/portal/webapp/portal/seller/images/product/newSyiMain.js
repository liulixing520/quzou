(function(g){var j=window.DH||(window.DH={});j.domain="dhgate.com";j.Widget={};var b=/^(\S+)\s*(.*)$/;var e=Object.prototype.hasOwnProperty;var l=Array.prototype.slice;var f=Array.prototype.concat;var k=function(m){return Object.prototype.toString.call(m)};var c=function(m){return k(m)==="[object Function]"};var a=function(m){return k(m)==="[object Object]"};var i=function(m){return k(m)==="[object Array]"};var d=function(m){return k(m)==="[object String]"};var h={bind:function(m,n){this.ev[m]=n;return this},unbind:function(m){this.ev[m]&&(delete this.ev[m]);return this},trigger:function(n){var m=true;if(this.ev[n]){m=this.ev[n].apply(this,l.call(arguments,1))}return m},proxy:function(){if(arguments.length===0){return}var m=arguments,o=m[0],n=m.length===1?this:(a(m[1])&&m[1]);return function(){return o.apply(n,m.length>2?f.call(l.call(m,2),l.call(arguments)):arguments)}},_supper:function(m){this.options=m=m||{};this.el=this.el||m.el;this.el=this.el&&(d(this.el)?g(this.el):this.el)||g(document);m.el&&delete m.el;this.ev={};this._bind()},_bind:function(){this.elements&&~function(m){for(var n in m.elements){e.call(m.elements,n)&&(m[m.elements[n]]=m.el.find(n))}}(this);this.events&&~function(m){for(var n in m.events){e.call(m.events,n)&&~function(){var p=b.exec(n),q=p[1],o=p[2],r=c(m.events[n])?m.events[n]:m[m.events[n]];if(r){r=m.proxy(r);if(o){m.el.delegate(o,q,r)}else{m.el.bind(q,r)}}}()}}(this)},_create:function(){function m(){}m.prototype=this;return new m},create:function(n){var m;m=function(){h._supper.apply(this,arguments);this.init&&c(this.init)&&this.init.apply(this,arguments)};g.extend(m.prototype,this._create());n&&a(n)&&g.extend(m.prototype,n);return m},single:function(n){var m;m=this._create();n&&a(n)&&g.extend(m,n);this._supper.apply(m,l.call(arguments,1));m.init&&c(m.init)&&m.init.apply(m,l.call(arguments,1));return m},tmpl:(function(){var n={};function m(q,p){var o=!/\W/.test(q)?n[q]=n[q]||m(document.getElementById(q).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+q.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return p?o(p):o}return m})()};j.Base=h})(window.jQuery);(function(b){var a=DH.Base.create({type:null,minWidth:400,zIndex:100000,opacity:0.5,template:{common:['<table class="noshade-pop-table j-dialog-container">',"<tbody><tr>",'<td class="t-lt"></td>','<td class="t-mid"></td>','<td class="t-ri"></td>',"</tr>","<tr>",'<td class="m-lt"></td>','<td class="m-mid">','<div class="mid-warp">','<div class="noshade-pop-content">','<div class="noshade-pop-title j-dialog-title-container">','<span class="j-dialog-title">操作提示</span>',"</div>",'<div class="noshade-pop-inner j-dialog-inner-container">',"</div>",'<div class="noshade-pop-bot j-dialog-bot-container"></div>',"</div>",'<a href="javascript:;" class="noshade-pop-close j-dialog-closer"></a>',"</div>","</td>",'<td class="m-ri"></td>',"</tr>","<tr>",'<td class="b-lt"></td>','<td class="b-mid"></td>','<td class="b-ri"></td>',"</tr>","</tbody></table>"].join(""),btn:'<span class="<%=className%>"><input type="button" value="<%=text%>"></span>',ac:['<div class="box1 align-center clearfix">','<p class="j-dialog-msg"></p>','<div class="align-center pop-button clearfix j-dialog-btns">',"</div>","</div>"].join(""),loading:['<div class="box1 align-center clearfix">',"<p>",'<span class="noshade-pop-loading"></span>','<span class="j-dialog-msg"></span>',"</p>","</div>"].join("")},isIE6:/msie\s*6.0/.test(navigator.userAgent.toLowerCase()),init:function(){this.initEl();this.initEv();return this},initEl:function(){var c=this,d=new Date-0;this.pev={};this.el=b("<div>");this.code=d;this.el.addClass("dh-dialog-"+d).html(this.template.common).hide();this.csDialogC=".j-dialog-container";this.csTitleC=".j-dialog-title-container";this.csTitle=".j-dialog-title";this.csInnerC=".j-dialog-inner-container";this.csCloser=".j-dialog-closer";this.csBotC=".j-dialog-bot-container";this.csMsg=".j-dialog-msg";this.csBtns=".j-dialog-btns";a.records=a.records||{};a.records[this.code]=this;a.showRecords=a.showRecords||[];b(function(){if(c.options.isClass!==true){b(document.body).append(c.el)}})},initEv:function(){var c=this;this.el.delegate(".j-dialog-closer","click",b.proxy(this.hide,this));b(window).bind("resize",b.proxy(this._setPos,this));if(!a.isBindEsc){b(document).bind("keyup",function(d){if(27===d.keyCode){if(a.showRecords.length===0){return}a.showRecords[a.showRecords.length-1].hide()}});a.isBindEsc=true}},_reset:function(){var c=this,d=this._options;this.el.find(this.csCloser).is(":hidden")&&this.el.find(this.csCloser).show();this.el.find(this.csTitleC).is(":hidden")&&this.el.find(this.csTitleC).show();this.el.find(this.csBtns).is(":hidden")&&this.el.find(this.csBtns).show();this.el.find(this.csBotC).is(":hidden")&&this.el.find(this.csBotC).show();this.el.find(this.csTitle).text(d.title||"操作提示");if(this.el.find(this.csBtns).length){if(d.btns&&d.btns.length){b(d.btns).each(function(f,h){var g=b(c.tmpl(c.template.btn,{text:h.text,className:h.className}));h.fn&&g.bind("click",b.proxy(h.fn,c));c.el.find(c.csBtns).append(g)})}else{if(this.type==="alert"){var e=b(c.tmpl(c.template.btn,{text:"确定",className:"yellowBtn valmiddle"}));e.bind("click",b.proxy(this.hide,this));this.el.find(this.csBtns).append(e)}else{this.el.find(this.csBtns).hide()}}}if(this.ev.show&&!this.ev.defaultShow){this.ev.defaultShow=this.ev.show}if(this.ev.hide&&!this.ev.defaultHide){this.ev.defaultHide=this.ev.hide}this.ev.show=d.show;this.ev.hide=d.hide},loading:function(d){var c=this;this.type="loading";this._options={};this._reset();this.show();this.el.find(this.csCloser).hide();this.el.find(this.csTitleC).hide();this.el.find(this.csBtns).hide();this.el.find(this.csBotC).hide();this.el.find(this.csInnerC).html(this.template.loading);this.el.find(this.csMsg).html(d)},alert:function(e,d){var c=this;this.type="alert";this._options=d||{};this.el.find(this.csInnerC).html(this.template.ac);this.el.find(this.csMsg).html(e);this._reset();this.show()},confirm:function(e,d){var c=this;this.type="confirm";this._options=d||{};this.el.find(this.csInnerC).html(this.template.ac);this.el.find(this.csMsg).html(e);this._reset();this.show()},html:function(c,e){var d=this;this.type="html";this._options=e||{};this.selector=typeof c==="string"?b(c):c;this.el.find(this.csInnerC).empty().append(this.selector.show());this._reset();this.show()},show:function(){var c=this,g,d=this.el,e=this._options.timeout;this.timeout&&(clearTimeout(this.timeout),(this.timeout=null));if(!d){return}if(!this.elMasker){g=this.elMasker=b("<div>");g.css({position:"fixed",width:"100%",height:"100%",left:0,top:0,backgroundColor:"#000",opacity:this.opacity,zIndex:this.zIndex});if(this.isIE6){g.css({position:"absolute",width:b(window).width(),height:Math.max(b(window).height(),b(document.body).height())});var f=b("<iframe>");f.css({position:"absolute",width:b(window).width(),height:Math.max(b(window).height(),b(document.body).height()),left:0,top:0,opacity:0}).attr({src:"about:blank"});g.append(f)}this.el.before(g)}else{this.elMasker.show()}d.show().css({position:"absolute",zIndex:this.zIndex});this._setCss();this._setPos();this.trigger("show");this.trigger("defaultShow");delete this.ev.show;e&&!isNaN(e)&&(this.timeout=setTimeout(function(){c.el.is(":visible")&&c.hide()},e));a.showRecords.push(this)},hide:function(){if(this.el.is(":hidden")){return}this.el.hide();this.elMasker.hide();this.type==="html"&&b(document.body).append(this.selector.hide());this.trigger("hide");this.trigger("defaultHide");delete this.ev.hide;a.showRecords.pop()},destory:function(){this.el&&this.el.remove();this.elMasker&&this.elMasker.remove();this.trigger("destory");delete a.records[this.code]},_setCss:function(){var c=this.el.find(this.csInnerC).children().eq(0).outerWidth(true);this.el.find(this.csDialogC).children().eq(0).css("width",Math.max(c,this.minWidth));c=this.el.find(this.csDialogC).children().eq(0).outerWidth(true);this.el.find(this.csDialogC).css("width",Math.max(c,this.minWidth));this.el.css("width",this.el.find(this.csDialogC).outerWidth(true))},_setPos:function(){if(this.el.is(":hidden")){return}var d=this.el.height(),c=this.el.width(),f=b(window).height()/2-d/2+b(window).scrollTop(),e=b(window).width()/2-c/2+b(window).scrollLeft();this.el.css({top:f<0?0:f,left:e<0?0:e});if(this.elMasker){if(this.isIE6){this.elMasker.css({width:b(window).width(),height:Math.max(b(window).height(),b(document.body).height())})}else{this.elMasker.css({width:"100%",height:"100%"})}}},reset:function(){this._setCss();this._setPos()}});DH.Widget.Dialog=a})(window.jQuery);(function(b){var a=DH.Base.create({isIE6:/msie\s*6.0/.test(navigator.userAgent.toLowerCase()),isIE7:/msie\s*7.0/.test(navigator.userAgent.toLowerCase()),init:function(){var c=this;this.id=new Date-0;this.isInitEl=false;this.backgroundColor=this.options.backgroundColor||"#000";this.opacity=this.options.opacity||0.5;this.zIndex=this.options.zIndex||100000;this.lightBackgroundColor=this.options.lightBackgroundColor||"#fff";this.lightOpacity=this.options.lightOpacity||0;this.animate=this.options.animate;this.speed=this.options.speed||300},initEl:function(){var f=this.id,e,c;if(this.isIE6||this.isIE7){for(var d=0;d<5;d++){e=b("<div>");e.addClass("j-light-"+f+" j-light-"+f+"-"+d);b(document.body).append(e)}this.$lights=b(".j-light-"+f+"");this.$lights.css({position:"absolute",backgroundColor:this.backgroundColor,opacity:this.opacity,zIndex:this.zIndex});if(this.isIE6){c=this.$masker=b("<iframe>");c.css({position:"absolute",width:b(window).width(),height:Math.max(b(window).height(),b(document.body).height()),left:0,top:0,opacity:0}).attr({src:"about:blank"});b(document.body).append(c)}}else{e=b("<div>");e.addClass("j-light-"+f);e.css({top:0,left:0,width:"100%",height:"100%",position:"fixed",backgroundColor:this.backgroundColor,opacity:this.opacity,zIndex:this.zIndex});this.$lights=e;c=b("<div>");c.css({position:"absolute",top:0,left:0});this.$masker=c;b(document.body).append(e);b(document.body).append(c)}},reset:function(k,e,f){if(!k){return}this.$el=k;var c=this.id,j=Math.max(b(document.documentElement).height(),b(document.body).height()),d=b(window).width(),i=this.zIndex,h,g;g=k.offset();h={top:g.top,left:g.left,width:k.outerWidth(true),height:k.outerHeight(true)};if(e){if(typeof e==="object"){b.extend(h,e)}else{if(typeof e==="function"){f=e}}}if(this.isIE6||this.isIE7){b(".j-light-"+c+"-0").css({left:0,top:0,width:d,height:h.top});b(".j-light-"+c+"-1").css({left:0,top:h.top+h.height,width:d,height:j-h.top-h.height});b(".j-light-"+c+"-2").css({left:0,top:h.top,width:h.left,height:h.height});b(".j-light-"+c+"-3").css({left:h.left+h.width,top:h.top,width:d-h.left-h.width,height:h.height});b(".j-light-"+c+"-4").css({left:h.left,top:h.top,width:h.width,height:h.height,backgroundColor:this.lightBackgroundColor,opacity:this.lightOpacity});f&&(typeof f==="function")&&f()}else{if(this.animate){this.$masker.css({position:"absolute",backgroundColor:this.lightBackgroundColor,opacity:1,zIndex:i+1});this.$masker.animate({left:h.left,top:h.top,width:h.width,height:h.height,opacity:this.lightOpacity},this.speed,function(){if(k.css("position")==="static"){k.css("position","relative")}k.css("zIndex",i+1);f&&(typeof f==="function")&&f()})}else{if(k.css("position")==="static"){k.css("position","relative")}k.css("zIndex",i+1);this.$masker.css({position:"absolute",left:h.left,top:h.top,width:h.width,height:h.height,backgroundColor:this.lightBackgroundColor,opacity:this.lightOpacity,zIndex:i+1});f&&(typeof f==="function")&&f()}}return this},show:function(){!this.isInitEl&&(this.initEl(),this.isInitEl=true);this.$lights.show();this.$masker&&this.$masker.show();return this},hide:function(){if(!this.isIE6&&!this.isIE7){this.$el.css({position:"",zIndex:""});this.$el.attr("style")===""&&this.$el.removeAttr("style")}this.$lights.hide();this.$masker&&this.$masker.hide();return this},destory:function(){this.hide();this.$el&&(this.$el=null);this.$lights.remove();this.$lights=null;this.$masker&&(this.$masker.remove(),this.$masker=null)}});window.DH.Widget.Guidelight=a})(window.jQuery);(function(f){var b={trim:function(h){return h.replace(/^\s*|\s*$/g,"")},isEmpty:function(h){return this.trim(h)===""},isNumber:function(h){return !isNaN(h)},isInteger:function(h){return this.isNumber(h)&&/^[0-9]*$/.test(h)},isPrice:function(h){return/^[0-9]*(\.[0-9]+)?$/.test(h)},isFloat:function(h){return this.isNumber(h)&&/^\d+(\.\d{0,2})?$/.test(h)},hasCN:function(h){return/[\u4e00-\u9fa5]/.test(h)}};var e=DH.Base.single({item:'<tr class="j-attr-item" data-id="<%=id%>" data-isother="<%=isother%>" data-defined="<%=defined%>" data-style="<%=style%>"><td class="bktit" title="<%=cleanName%>"><%=name%>：</td><td class="bkcon j-attrList" data-aid=<%=id%>><%=content%></td></tr>',name_required:'<span class="required">*</span><%=name%>',brand:'<div class="posionrel clearfix">					<div onclick="onSelectBrandsClick();" id="selectBrandsDiv" class="drop-down">			            <span id="brandNameSpan" class="drop-down-value text-indent">- 无品牌 -</span>			            <span class="drop-down-default"></span>			            <div style="display: none;" id="brandsDiv" class="chouse-down-box text-indent"><span>- 无品牌 -</span><span class="lasted"><a onclick="onClickSelectBrandBtn();" href="#">选择其它品牌</a></span></div>			            <iframe></iframe>			        </div>			     </div>',single:{wrap:'<select class="attr-select j-attr-select" name="c_<%=id%>_vname"><%=list%></select>',item:'<option value="<%=value%>" data-text="<%=text%>" data-etext="<%=etext%>"><%=text%></option>'},multi:{wrap:'<p class="marginbottom5"><input type="checkbox" class="cheack-box-input j-attr-chkall" /> 全选</p> <%=list%>',wrap_standard:"<%=list%>",wrap_one:'<p class="marginbottom5"> <label class="cheack-box-pb"><%=list%></label></p>',one:"<%=text%>",item:'<label class="cheack-box-pb">						<input type="checkbox" name="c_<%=id%>_vname" value="<%=id%>_<%=value%>" data-text="<%=text%>" data-etext="<%=etext%>" class="cheack-box-input j-attr-checkbox" />						<span class="colorbox" style="<%=(pic === "" ? "display:none;" : "")%>"><img width="11" height="11" src="<%=pic%>"></span>						<span class="marginright10"><%=text%></span>					</label>',item_defined:'<p class="marginbottom5">							<label class="cheack-box-pb">								<input type="checkbox" name="c_<%=id%>_vname" value="<%=id%>_<%=value%>" data-text="<%=text%>" data-etext="<%=etext%>" class="cheack-box-input j-attr-checkbox j-attr-checkbox-defined" />								<span class="marginright10"><%=text%></span>							</label>						</p>'},text:{item:'<input type="text" class="attr-text-input j-attr-text" style="ime-mode:disabled;" />'},defined_text:{wrap:'<table class="edit-properties j-attr-define" style="display:none;">						<tbody class="j-attr-define-list">							<tr>								<th>默认参数</th>								<th>自定义内容</th>							</tr>						</tbody>					  </table>',item:'<tr class="j-defined-item j-defined-<%=id%>-<%=value%>">						<td class="pro-edit-rt"><%=text%></td>						<td class="pro-edit-rt">							<input type="text" class="attr-text-input textnamebox j-defined-input <%=otherclass%>" value="<%=etext%>">						</td>					</tr>'},defined_pic:{wrap:'<table class="edit-properties j-attr-define" style="display:none;">						<tbody class="j-attr-define-list">							<tr><th>颜色分类</th><th>自定义颜色图片（图片格式JPG,大小200k以内,可不添加）</th></tr>						</tbody>					</table>',item:'<tr class="j-defined-item j-defined-<%=id%>-<%=value%>">						<td class="pro-edit-rt">							<span class="colorbox" style="<%=(pic === "" ? "display:none;" : "")%>"> <img width="11" height="11" src="<%=pic%>"> </span>							<span class="marginright5"><%=text%></span>						</td>						<td class="pro-edit-rt">							<span class="tourobjBtn">								<input width="73" type="button" height="27" id="attrValFileupload_<%=id%>_<%=value%>" style="visibility: hidden; display: none; " value="选择图片">							</span>							<span style="display:none" class="text-pro-upload j-defined-pic-item">								<img width="20" height="20" class="j-defined-pic-pic" src="<%=pic%>">								<span style="display:inline-block;width:90px;" class="j-defined-pic-text"></span>								<input type="hidden" value="<%=picUrl%>" class="j-defined-pic-picurl">								<a class="marginleft10 j-defined-pic-del" href="javascript:;">删除</a>							</span>							<span id="attrPicQueue_<%=id%>_<%=value%>"></span>						</td>					</tr>'},defined_text_pic:{wrap:'<table class="edit-properties j-attr-define" style="display:none;">						<tbody class="j-attr-define-list">							<tr><th>颜色分类</th><th>自定义颜色图片（图片格式JPG,大小200k以内,可不添加）</th></tr>						</tbody>					</table>',item:'<tr class="j-defined-item j-defined-<%=id%>-<%=value%>">						<td class="pro-edit-rt">							<span class="colorbox" style="<%=(pic === "" ? "display:none;" : "")%>"> <img width="11" height="11" src="<%=pic%>"> </span>							<span class="marginright5"><%=text%></span>							<input type="text" class="attr-text-input colornamebox j-defined-input <%=otherclass%>" value="<%=etext%>">						</td>						<td class="pro-edit-rt">							<span class="tourobjBtn">								<input width="73" type="button" height="27" id="attrValFileupload_<%=id%>_<%=value%>" style="visibility: hidden; display: none; " value="选择图片">							</span>							<span style="display:none" class="text-pro-upload j-defined-pic-item">								<img width="20" height="20" class="j-defined-pic-pic" src="<%=pic%>">								<span style="display:inline-block;width:90px;" class="j-defined-pic-text"></span>								<input type="hidden" value="<%=picUrl%>" class="j-defined-pic-picurl">								<a class="marginleft10 j-defined-pic-del" href="javascript:;">删除</a>							</span>							<span id="attrPicQueue_<%=id%>_<%=value%>"></span>						</td>					</tr>'},custom_attr:{wrap:'<tr>						<td class="bktit">自定义属性：</td>						<td class="bkcon j-custom-attr-list">							<div class="j-custom-attr-item">								<p class="marginbottom5 clearfix">									<input type="text" class="attr-text-input custom1 j-custom-attr-name">									<input type="text" class="attr-text-input custom1 j-custom-attr-value">									<a class="custom1 j-custom-attr-add" href="javascript:;">添加更多</a>								</p>								<div style="display:none" class="tip-error j-custom-attr-tip-error">									<span></span>								</div>							</div>						</td>					</tr>',item:'<div class="j-custom-attr-item">						<p class="marginbottom5 clearfix">							<input type="text" class="attr-text-input custom1 j-custom-attr-name">							<input type="text" class="attr-text-input custom1 j-custom-attr-value">							<a class="custom1 j-custom-attr-remove" href="javascript:;">删除</a>						</p>						<div style="display:none" class="tip-error j-custom-attr-tip-error">							<span></span>						</div>					</div>'},error:'<div id="tip-error-attr-<%=id%>" style="display:none;" class="tip-error j-tip-error"><span></span></div>'});var a=DH.Base.single({cgi:{getAttrs:"/syi/cateAttrL.do",getChildAttr:"/syi/findChildAttrVal.do"},config:{imgDomain:"http://image.dhgate.com/",definedAttrMaxNum:10,definedAttrId:11},productAttrVO:{"class":"com.dhgate.syi.model.ProductAttributeVO",attrId:0,attrName:"",isbrand:0,valueList:[]},productAttrValVO:{"class":"com.dhgate.syi.model.ProductAttributeValueVO",attrValId:0,lineAttrvalName:"",lineAttrvalNameCn:"",iscustomsized:"0",picUrl:""},init:function(){var h=this;this.cacheAttrs={};this.cacheEditAttrs={};this.catePubId=f("#inp_catepubid").val();f(function(){h.catePubId&&h.getAttrs()})},getAttrs:function(){var h={};f.extend(h,{catePubId:this.catePubId,isblank:true,_:new Date-0});f.get(this.cgi.getAttrs,h,this.proxy(this.getAttrsBack));isWeigthRange_CatePub(this.catePubId)},getAttrsBack:function(h){if(h&&+h.code>0&&h.data){this.trigger("success",h.data.attributeList);G_EVENT.trigger("attributeLoadSuccess",[h.data.attributeList])}else{}}});var d=DH.Base.create({changeSelect:function(o){var i=f(o.target),r=i.find("option:selected"),u=i.closest(".j-attr-item"),t=u.find(".j-attr-define"),n=t.find(".j-attr-define-list"),k=+u.attr("data-id"),s=i.val(),l=a.cacheAttrs[k],x=this.getItem(l,s),p=+u.attr("data-isother"),m=+u.attr("data-defined"),h=+u.attr("data-style"),q=+l.childAttrId,w=f("#tip-error-attr-"+k);if(s!==""){if(m===1||p===1&&+s===0){var s=s,v=r.attr("data-text"),j=r.attr("data-etext");t.show();n.find(".j-defined-item").hide();this.addDefined(n,{style:h,id:k,value:s,text:+s===0?"自定义":v,etext:j,otherclass:+s===0?"j-defined-other":"",pic:x.picUrl})}else{t.hide()}this.hideErr(w)}else{t.hide()}if(q){this.getChildAttr(k,s,q)}},clickCheckbox:function(i){var h=f(i.target);this.checkItem(h)},checkAll:function(o){var j=this,l=f(o.target),i=l.closest(".j-attr-item"),n=i.find(".j-attr-checkbox"),m=i.find(".j-attr-define"),k=m.find(".j-attr-define-list"),h=l.attr("checked");n.attr("checked",h);n.each(function(){j.checkItem(f(this))})},checkItem:function(h){var i=h,h=i.closest(".j-attr-item"),j=h.find(".j-attr-define");$list=j.find(".j-attr-define-list"),id=+h.attr("data-id"),value=i.val().split("_")[1],text=i.attr("data-text"),etext=i.attr("data-etext"),ischk=i.attr("checked"),itemObj=this.getItem(a.cacheAttrs[id],value),isother=+h.attr("data-isother"),defined=+h.attr("data-defined"),style=+h.attr("data-style"),$err=f("#tip-error-attr-"+id);if(defined===1||(isother===1&&+value===0)){if(ischk){j.show();this.addDefined($list,{style:style,id:id,value:value,text:text,etext:etext,otherclass:(+value===0?"j-defined-other":""),pic:itemObj.picUrl})}else{this.removeDefined(h.find(".j-defined-"+id+"-"+value));$list.find(".j-defined-item:visible").length===0&&j.hide()}}this.hideErr($err)},keyupAttrText:function(k){var i=f(k.target),h=i.closest(".j-attr-item"),l=+h.attr("data-id"),j=f("#tip-error-attr-"+l);this.hideErr(j)},keyupOther:function(k){var i=f(k.target),h=i.closest(".j-attr-item"),l=+h.attr("data-id"),j=a.cacheAttrs[l];this.chkItem(j)},setUploader:function(n,l){var h=this,m=n+"_"+l,i="*.jpg;",j="choose *.jpg";function k(q,o,p,r){var s=f("#tip-error-attr-"+r);if(p.size>220000){h.showErr(s,"您选取的图片中有大于200K的图片");return false}if(p.size<100){h.showErr(s,"您选取的图片中有小于100K的图片");return false}if((p.type).toLowerCase()!=".jpg"){h.showErr(s,"您选取的图片中有非jpg格式的图片");return false}return true}f("#attrValFileupload_"+m).uploadify({uploader:"/syi/js/photo/upload2/uploadalbums.swf",script:"http://upload.dhgate.com/fileuploadservlet",cancelImg:"/syi/js/photo/upload2/cancel.png",folder:"uploaddify",scriptAccess:"always",method:"GET",queueID:"attrPicQueue_"+m,auto:false,multi:false,queueSizeLimit:1,simUploadLimit:1,sizeLimit:204800,hideButton:true,wmode:"transparent",width:73,height:27,fileExt:i,fileDesc:j,onInit:function(){sid=f("#supplierid").val();fName=f("#functionname_avim").val();iName=f("#imagebannername_avim").val()},onError:function(r,o,q,p){},onSelect:function(r,o,q){var t=f("#tip-error-attr-"+n);h.hideErr(t);if(k(r,o,q,n)){var u=fName;var s=sid;var p=iName;f("#attrValFileupload_"+m).uploadifySettings("scriptData",{functionname:u,supplierid:s,imagebannername:p});f("#attrValFileupload_"+m).uploadifyUpload()}else{return false}},onComplete:function(q,s,t,u,v){if(u){var z=f.parseJSON(u),y=h.el.find(".j-defined-"+n+"-"+l).find(".j-defined-pic-item"),x=y.find(".j-defined-pic-text"),r=y.find(".j-defined-pic-pic"),o=y.find(".j-defined-pic-picurl"),p=z.l_imgurl,w=z.l_localfilename;x.html(w.length>6?w.slice(0,6)+"...":w);r.attr("src",a.config.imgDomain+p);o.val(p);y.show()}},onAllComplete:function(r,p,q,o,s){}})},renderEdit:function(){var h=this,i=f("#div_attrlistid").text();if(i===""){return}try{i=f.parseJSON(i);f(i).each(function(k,l){h.renderEditItem(l)})}catch(j){}},renderEditItem:function(n){var v=this,w=n.attrId,p=a.cacheAttrs[w],m=+n.type,B=+n.style,o=+n.isbrand,k=p?+p.defined:0,l=p?+p.isother:0,r=n.valueList,j=v.el.find('.j-attr-item[data-id="'+w+'"]'),t=j.find(".j-attr-define"),h=t.find(".j-attr-define-list");if(p&&j.length){if(o===1){var F=r[0],x=+F.attrValId,q=F.brandsVO;if(x!==99&&q){f("#brandNameSpan").text(q.brandname);f("#brandid").val(x)}}if(m===1){var E=r;f(E).each(function(i,N){var I=N,K=I.attrValId+"",J=v.getItem(p,K),L=I.lineAttrvalNameCn,M=I.lineAttrvalName,H=I.picUrl;J.picUrl=H;j.find('.j-attr-checkbox[value="'+w+"_"+K+'"]').attr("checked",true);if(k||l===1&&+K===0){t.show();v.addDefined(h,{style:B,id:w,value:K,text:+K===0?"自定义":L,etext:M,otherclass:+K===0?"j-defined-other":"",pic:H})}})}if(m===2){var C=j.find(".j-attr-select"),F=r[0],x=F.attrValId,G=v.getItem(p,x),s=F.lineAttrvalNameCn,D=F.lineAttrvalName,u=F.picUrl;G.picUrl=u;C.val(x);if(k===1||l===1&&+x===0){t.show();v.addDefined(h,{style:B,id:w,value:x,text:+x===0?"自定义":s,etext:D,otherclass:+x===0?"j-defined-other":"",pic:u})}}if(m===4||m===5){var y=j.find(".j-attr-text"),F=r[0],s=F.lineAttrvalName;y.val(s)}if(p.childAttrId&&+p.childAttrId>0){v.getChildAttr(w,F.attrValId,p.childAttrId)}}if(v.type===1&&w===a.config.definedAttrId){var h=v.elAttrslist.find(".j-custom-attr-list"),E=r;if(E.length>0){h.find(".j-custom-attr-name").eq(0).val(E[0].attrName);h.find(".j-custom-attr-value").eq(0).val(E[0].lineAttrvalName);for(var z=1,A=E.length;z<A;z++){v.addCustomAttr();h.find(".j-custom-attr-name").eq(z).val(E[z].attrName);h.find(".j-custom-attr-value").eq(z).val(E[z].lineAttrvalName)}}}a.cacheEditAttrs[w]=f.extend(true,{},n)},renderList:function(i){var h=this;if(i&&i.length){f(i).each(function(j,k){h.renderAttr(k)});this.type===1&&this.renderCustom();this.renderEdit()}else{}},renderAttr:function(i){if(i){var h;if(+i.buyAttr===0&&+i.saleAttr===0){h=this.elAttrslist}else{if(+i.buyAttr===1){h=this.elBuyAttrsList}if(+i.saleAttr===1){h=this.elSaleAttrsList}}this.renderAttrWith(i,1,h)}},renderAttrWith:function(y,B,l,t){if(y){var D=a.config.imgDomain,o=+y.buyAttr===0&&+y.saleAttr===0,r=this.tmpl,C=e,x=y.attrId,E=y.lineAttrNameCn,q=y.lineAttrName,w=E,u=+y.required,j=+y.defined,p=+y.isbrand,m=+y.type,A=+y.style,k=+y.isother,i=+y.located,s=y.valueList||[],z="";if(u===1&&p===0){E=r(C.name_required,{name:E})}if(p===1){z=C.brand}else{if(i===1){var v=[],n=s.slice(0);f(n).each(function(F,G){v.push(r(C.multi.one,{text:n[0].lineAttrvalNameCn+(G.picUrl?' <img width="11" height="11" src="'+D+G.picUrl+'">':"")}))});z=r(C.multi.wrap_one,{list:v.join(",")})}else{if(m===1){var v=[],n=s.slice(0);k===1&&n.push({attrValId:"0",lineAttrvalNameCn:"自定义",lineAttrvalName:""});f(n).each(function(F,G){v.push(r(C.multi[+G.attrValId===0?"item_defined":"item"],{id:x,value:G.attrValId,text:G.lineAttrvalNameCn,etext:G.lineAttrvalName,pic:G.picUrl?D+G.picUrl:""}))});z=r(o?C.multi.wrap:C.multi.wrap_standard,{list:v.join("")})}if(m===2){var v=[],n=s.slice(0);n.unshift({attrValId:"",lineAttrvalNameCn:"请选择",lineAttrvalName:""});k===1&&n.push({attrValId:"0",lineAttrvalNameCn:"自定义",lineAttrvalName:""});f(n).each(function(F,G){v.push(r(C.single.item,{id:x,value:G.attrValId,text:G.lineAttrvalNameCn,etext:G.lineAttrvalName}))});z=r(C.single.wrap,{id:x,list:v.join("")})}if(m===4||m===5){z=C.text.item}}if(k===1||j===1){switch(A){case 1:z+=C.defined_text.wrap;break;case 2:z+=C.defined_pic.wrap;break;case 3:z+=C.defined_text_pic.wrap;break}}if(u===1||k===1||j===1){z+=r(C.error,{id:x})}}a.cacheAttrs[x]=f.extend(true,{},y);if(l){var h=f(r(C.item,{cleanName:w,id:x,name:E,isother:k,defined:j,style:A,content:z}));if(B===1){l.append(h)}if(B===2){l.after(h)}if(t){h.attr("data-parentid",l.attr("data-id"));if(m===2&&s.length===0&&!a.cacheEditAttrs[x]){h.find(".j-attr-select").val("0").trigger("change")}}}}else{}},addDefined:function(m,l){var k=a.config.imgDomain,h=e,i=l.style,n="defined_text",j;switch(i){case 1:n="defined_text";break;case 2:n="defined_pic";break;case 3:n="defined_text_pic";break}if((j=m.find(".j-defined-"+l.id+"-"+l.value)).length){j.show()}else{j=f(this.tmpl(h[n]["item"],{id:l.id,value:l.value,text:l.text,etext:l.etext.replace(/\"/g,"&quot;"),otherclass:l.otherclass,pic:l.pic?k+l.pic:"",picUrl:l.pic}));m.append(j);(i===2||i===3)&&this.setUploader(l.id,l.value)}l.pic&&j.find(".j-defined-pic-item").show()},removeDefined:function(h){h.hide()},delDefinedPic:function(k){var i=f(k.target),h=i.closest(".j-defined-pic-item"),l=h.find(".j-defined-pic-picurl"),j=h.find(".j-defined-pic-pic");l.val("");j.attr("src","");h.hide();return false},hasTextStyle:function(h){return h===1||h===3},chkItem:function(t){var j=t.attrId,h=+t.style,n=+t.type,o=+t.isother,i=t.lineAttrNameCn,m=+t.required,r=this.el.find('.j-attr-item[data-id="'+j+'"]'),s=f("#tip-error-attr-"+j);if(n===1){if(m===1&&r.find(".j-attr-checkbox:checked").length===0){this.showErr(s,"请选择"+i+"属性值。")}else{if(o===1&&this.hasTextStyle(h)){if(!!r.find(".j-attr-checkbox-defined").attr("checked")){var l=r.find(".j-defined-other").val();if(b.isEmpty(l)){this.showErr(s,"请填写自定义属性值。")}else{this.hideErr(s)}}}else{this.hideErr(s)}}}if(n===2){var k=r.find(".j-attr-select"),q=k.val();if(m===1&&q===""){this.showErr(s,"请选择"+i+"属性值。")}else{if(o===1&&this.hasTextStyle(h)){if(q==="0"){var l=r.find(".j-defined-other").val();if(b.isEmpty(l)){this.showErr(s,"请填写自定义属性值。")}else{this.hideErr(s)}}}else{this.hideErr(s)}}}if(n===4||n===5){var p=r.find(".j-attr-text"),q=p.val();if(m===1&&b.isEmpty(q)){this.showErr(s,"请填写"+i+"属性值。")}else{if(n===4&&q.length>40){this.showErr(s,i+"不能超过40个字符。")}else{if(n===5&&!b.isNumber(q)){this.showErr(s,i+"格式不正确。")}else{this.hideErr(s)}}}}},getItemAttrs:function(C){var x=C.attrId,h=this.el.find('.j-attr-item[data-id="'+x+'"]'),n=+C.type,l=+C.isother,k=+C.defined,p=+C.isbrand,E=C.lineAttrNameCn,q=C.lineAttrName,B=[],r;if(p){B.push(f.extend({},a.productAttrValVO,{attrValId:+f("#brandid").val(),lineAttrvalName:""}))}else{if(n===1){var s=h.find(".j-attr-checkbox:checked");if(s.length){for(var z=0,A=s.length;z<A;z++){var j=s.eq(z),y=j.val().split("_")[1],u=h.find(".j-defined-"+x+"-"+y),m=+y,t=this.getItem(C,y),E=t.lineAttrvalName,w="",v=t.iscustomsized;if(l===1&&+y===0||k===1){var o=u.find(".j-defined-input"),D=u.find(".j-defined-pic-picurl");E=o.length?o.val():E;w=D.length?D.val():w}B.push(f.extend({},a.productAttrValVO,{attrValId:m,lineAttrvalName:E,lineAttrvalNameCn:"",iscustomsized:v||"0",picUrl:w}))}}}if(n===2){var y=h.find(".j-attr-select").val(),u=h.find(".j-defined-"+x+"-"+y),m=+y,t=this.getItem(C,y),E=t.lineAttrvalName;w="",v=t.iscustomsized;if(y!==""){if(l===1&&+y===0||k===1){var o=u.find(".j-defined-input"),D=u.find(".j-defined-pic-picurl");E=o.length?o.val():E;w=D.length?D.val():w}B.push(f.extend({},a.productAttrValVO,{attrValId:m,lineAttrvalName:E,lineAttrvalNameCn:"",iscustomsized:v||"0",picUrl:w}))}}if(n===4||n===5){var y=h.find(".j-attr-text").val();if(y!==""){B.push(f.extend({},a.productAttrValVO,{attrValId:null,lineAttrvalName:y}))}}}if(B.length){r={};f.extend(r,a.productAttrVO,{attrId:x,attrName:q,isbrand:p+"",valueList:B})}return r},getChildAttr:function(m,k,j){var i=this.el.find('.j-attr-item[data-parentid="'+m+'"]'),l={};if(i.length){var h=+i.attr("data-id");a.cacheAttrs[h]&&(delete a.cacheAttrs[h]);i.remove()}if(k+""===""){return}f.extend(l,{catePubId:a.catePubId,parentAttrValId:k,childAttrId:j});f.get(a.cgi.getChildAttr,l,this.proxy(this.getChildAttrBack,this,m,k))},getChildAttrBack:function(j,i,h){if(h){if(+h.code>0){this.renderChildAttr(h.data,j,i)}else{alert("获取二级属性出错。")}}else{alert("获取二级属性失败。")}},renderChildAttr:function(i,k,j){if(+j!==0||(+j===0&&+i.isother===1)){var h=this.el.find('.j-attr-item[data-id="'+k+'"]');this.renderAttrWith(i,2,h,true);this.renderEditChildAttr(+i.attrId)}},renderEditChildAttr:function(i){if(!i){return}var h=a.cacheEditAttrs[i];if(h){this.renderEditItem(h);delete a.cacheEditAttrs[i]}},getItem:function(i,j){var h={};f(i.valueList).each(function(k,l){if(+j===+l.attrValId){h=l;return false}});return h},showErr:function(h,i){h.show().find("span").html(i);showErrorTip("productattr","产品属性错误")},hideErr:function(h){h.is(":visible")&&h.hide()}});var c=new d().single({el:".j-basic-attr-container",type:1,elements:{".j-attrs-list":"elAttrslist"},events:{"click .j-custom-attr-add":"addCustomAttr","click .j-custom-attr-remove":"removeCustomAttr","keyup .j-attr-text":"keyupAttrText","blur .j-custom-attr-name":"blurCustomAttr","blur .j-custom-attr-value":"blurCustomAttr","keyup .j-defined-other":"keyupOther","click .j-defined-pic-del":"delDefinedPic","change .j-attr-select":"changeSelect","change .j-attr-checkbox":"clickCheckbox","change .j-attr-chkall":"checkAll"},init:function(){this.currentCustomAttrNum=1},renderCustom:function(){this.elAttrslist.append(e.custom_attr.wrap)},blurCustomAttr:function(j){var i=f(j.target),h=i.closest(".j-custom-attr-item");this.chkCustomAttr(h)},chkCustomAttr:function(h){if(!h){return}var m=h.find(".j-custom-attr-name"),j=h.find(".j-custom-attr-value"),i=m.val(),k=j.val(),l=h.find(".j-custom-attr-tip-error");if(!b.isEmpty(i)&&b.isEmpty(k)){this.showErr(l,"请输入自定义属性的值。")}else{if(b.isEmpty(i)&&!b.isEmpty(k)){this.showErr(l,"请输入自定义属性的名称。")}else{this.hideErr(l)}}},addCustomAttr:function(){if(this.currentCustomAttrNum===a.config.definedAttrMaxNum){alert("最多能添加10个自定义属性。");return false}this.elAttrslist.find(".j-custom-attr-list").append(e.custom_attr.item);this.currentCustomAttrNum++;return false},removeCustomAttr:function(j){var i=f(j.target),h=i.closest(".j-custom-attr-item");h.remove();this.currentCustomAttrNum--;return false},getAllAttrs:function(m){var o=a.cacheAttrs,h=[],j;for(var l in o){if(o.hasOwnProperty(l)){var n=o[l],k;if(+n.isbrand===1||+n.buyAttr===0&&+n.saleAttr===0){m&&this.chkItem(n);(k=this.getItemAttrs(n))&&h.push(k)}}}if(j=this.getCustomAttrs()){h.push(j)}return h},getCustomAttrs:function(k){var j=this,i=this.elAttrslist.find(".j-custom-attr-item"),l=[],h;i.each(function(){var m=f(this),q=m.find(".j-custom-attr-name"),o=m.find(".j-custom-attr-value"),n=q.val(),p=o.val();k&&j.chkCustomAttr(m);if(!b.isEmpty(n)&&!b.isEmpty(p)){l.push(f.extend({},a.productAttrValVO,{attrId:a.config.definedAttrId,attrName:n,lineAttrvalName:p}))}});if(l.length){h={};f.extend(h,a.productAttrVO,{attrId:a.config.definedAttrId,attrName:"",isbrand:"0",valueList:l});return h}return null}});var g=new d().single({el:".j-basic-standard-container",type:2,elements:{".j-attrs-list":"elAttrslist",".j-buy-attrs-list":"elBuyAttrsList",".j-sale-attrs-list":"elSaleAttrsList"},events:{"change .j-attr-select":"changeSelect","change .j-attr-checkbox":"clickCheckbox","change .j-attr-chkall":"checkAll","keyup .j-attr-text":"keyupAttrText","keyup .j-defined-other":"keyupOther","click .j-defined-pic-del":"delDefinedPic"},getAllAttrs:function(l){var n=a.cacheAttrs,h=[];for(var k in n){if(n.hasOwnProperty(k)){var m=n[k],j;if(+m.buyAttr===1||+m.saleAttr===1){l&&this.chkItem(m);(j=this.getItemAttrs(m))&&h.push(j)}}}return h}});DH.Base.single({init:function(){a.bind("success",function(h){c.renderList(h);g.renderList(h)});G_EVENT.bind("setSyiAttrs",this.proxy(this.setSyiAttrs));G_EVENT.bind("getSyiAttrs",this.proxy(this.getSyiAttrs))},setSyiAttrs:function(){var h=[];h=h.concat(c.getAllAttrs(true));h=h.concat(g.getAllAttrs(true));f("#attrlistid").val(JSON.stringify(h));f("#loadingimg").removeClass().addClass("submit-syi loadding-syi-btn");f("#submitopt").html("正在提交...40%")},getSyiAttrs:function(){var h=[];h=h.concat(c.getAllAttrs(false));h=h.concat(g.getAllAttrs(false));f("#attrlistid").val(JSON.stringify(h))}})})(window.jQuery);(function(c){var b;var a=DH.Base.create({events:{"click .j-closer":"close"},init:function(){this.elProreference=c(".syi-proreference-box");this.elProdMove=c("#isProdMove");this.elShowMoveTip=c("#isShowMoveTip");if(this.chkIsShowMove()){this.elProreference.show().find("a").bind("click",function(){window.open(c(this).attr("href"),"oldproduct");return false})}if(!this.chkIsShowGuide()){return}var d=this;c(function(){b=new DH.Widget.Guidelight().show();d.el.show();d.reset();d.resetFn=d.proxy(d.reset);c(window).bind("resize",d.resetFn)})},reset:function(){var d=this.elProreference,e;if(d.length===0){b.hide();return}d.height(110);c(".show-translabox").hide();e=d.offset();this.el.css({zIndex:b.zIndex+1,left:e.left-this.el.width()-d.width()-20,top:e.top-240});c("#translateBox").css("zIndex",b.zIndex+1);b.reset(d,{top:e.top-120,left:e.left})},chkIsShowMove:function(){return +this.elProdMove.val()===1},chkIsShowGuide:function(){return +this.elShowMoveTip.val()===1},close:function(){this.el.hide();b.hide();c(".show-translabox").show();c("#translateBox").css("zIndex","");c(window).unbind("resize",this.resetFn);return false}});new a({el:".j-dialog-missattribute"})})(window.jQuery);(function(c){var a;var b=DH.Base.create({events:{"click .j-btn-return":"returnCategory"},init:function(){var d=c("#isValidCategory").val();if(+d!==1){return}a=new DH.Widget.Dialog().bind("show",function(){this.el.find(".j-dialog-closer").hide()});c(function(){a.html(".j-dialog-returncategory")})},returnCategory:function(){c(".cat-titleconbox").find("a").trigger("click")}});new b({el:".j-dialog-returncategory"})})(window.jQuery);(function(){var a={el:$(".j-sale-container"),trim:function(b){return b.replace(/^\s*|\s*$/g,"")},isEmpty:function(b){return this.trim(b)===""},isNumber:function(b){return !isNaN(b)},isInteger:function(b){return this.isNumber(b)&&/^[1-9][0-9]*$/.test(b)},isPrice:function(b){return/^([1-9]\d*)$|^(0|[1-9]\d*)\.(\d){1,2}$/.test(b)&&+b>=0.01&&+b<=999999},catePubId:$("#inp_catepubid").val(),cateMinPrice:$("#cateMinPrice").val(),isquickup:$("#isquickup").val(),isSku:function(){var c=[];try{c=$.parseJSON($.trim($("#div_proSkuInfo").text()))}catch(b){console.log("sku 信息反序列化失败！")}return c&&c.length>0&&(c[0].skuInfoList&&c[0].skuInfoList.length>0&&c[0].skuInfoList[0].attrList&&c[0].skuInfoList[0].attrList.length>0)},ispromotion:$("#ispromotion").val(),isProductCode:function(b){return/^[\w\-\s\.@#$%^&\*\(\)\-\=\+\[\]\{\}\:\;'",\.\?\/\\\|\`\~]+$/.test(b)},isStock:function(){return this.el.find('input[name="inventoryStatus"]').eq(0).attr("checked")},isUnifyPrice:function(){return this.el.find('input[name="setdiscounttype"]').eq(0).attr("checked")},isUnitSale:function(){return this.el.find('input[name="sortby"]').eq(0).attr("checked")},getUnit:function(){var b=this.isUnitSale()?this.el.find("select.j-select-unit option:selected").attr("data-name"):"包";return b},getFirstUnityPrice:function(){return this.isUnifyPrice()?this.el.find(".j-section-price:first").val():0},isUnifyPeriod:function(){return this.el.find(".j-set-unifyperiod").attr("checked")},getUnifyPeriod:function(){return this.el.find('input[name="proLeadingtime"]').val()},getOriginStockNum:function(){return this.el.find('input[name="inventory"]').val()},getFirstStock:function(){var b=$("#inventoryLocation");return{code:b.val(),name:b.find("option:selected").text(),el:b}},getOriginSkuCode:function(){return this.el.find('input[name="skuCode"]').val()}};window.SyiSale={Tools:a}})();(function(d){var b=window.SyiSale;var c=b.Tools;var a=DH.Base.create({elements:{".j-act-attach":"elActAttach",".j-error-tip":"elErr"},events:{"click .j-act-attach":"attach","click .j-act-remove":"remove","change select":"selectChange"},init:function(){var f=d("#inventoryLocation"),e=f.val();this.selects=[e];this.el.find(".j-item:first").attr("data-code",e);this.wrap="@";CustomEvent.bind("syiSale.stockType.change",this.proxy(this.stockTypeChange));CustomEvent.bind("Standards.loadDefault",this.proxy(this.loadDefault))},loadDefault:function(o,j){if(!j){return}var p,h,i,k,f,n;n=1;for(var g=0,l=j.skuList.length;g<l;g++){p=this.el.find(".j-item:last");f=j.skuList[g].code||this.selects[0];if(!k){p.find("select").val(f);p.attr("data-code",f);this.selects[0]=f;k=true}else{h=p.clone();h.find("select").val(f);h.attr("data-code",f);p.after(h);this.selects.push(f);n++}}CustomEvent.trigger("sku.more.numchange",[n>1?1:0]);this.chkLen()},clear:function(){this.el.find(".j-item").not(":first").remove();this.selects=this.selects.slice(0,1);this.el.find("a").css("color","").removeClass("disabled");CustomEvent.trigger("sku.more.numchange",[0])},attach:function(m){var g=d(m.currentTarget);if(g.hasClass("disabled")){return false}if(this.selects.length===7){return false}var o=this.el.find(".j-item:last"),j=o.clone(),i=this.wrap,n=this.selects,l=i+n.join(i)+i,k,h,f;o.after(j);(k=j.find("select")).val(function(){var e="";k.find("option").each(function(){if(l.indexOf(i+(e=d(this).val())+i)<0){return false}});n.push(e);return e});h=k.val();j.attr("data-code",h);this.chkLen();f=k.find("option:selected").text();CustomEvent.trigger("sku.more.attach",[h,f]);CustomEvent.trigger("sku.more.numchange",[1]);return false},remove:function(m){var j=d(m.currentTarget),f=j.closest(".j-item"),i=f.find("select"),h=f.index(),k=this.selects,l=f.attr("data-code"),g;if(j.hasClass("disabled")){return false}if(k.length===1){return false}k.splice(h,1);f.remove();this.chkRepeat();this.chkLen();g=i.find("option:selected").text();CustomEvent.trigger("sku.more.remove",[l,g]);if(k.length===1){CustomEvent.trigger("sku.more.numchange",[0])}return false},selectChange:function(m){var i=d(m.currentTarget),f=i.closest(".j-item"),h=f.index(),l=f.attr("data-code"),k=i.val(),g=i.find("option:selected").text(),j=this.selects;j[h]=k;if(this.chkRepeat()){f.attr("data-code",k);this.el.find("a").css("color","").removeClass("disabled");CustomEvent.trigger("sku.more.change",[l,k,g])}else{this.el.find(".j-item").find("select").attr("disabled",true);this.el.find("a").css("color","#999").addClass("disabled");i.closest(".j-item").find(".j-act-remove").css("color","").removeClass("disabled");i.attr("disabled",false)}},chkLen:function(){var f=this.selects,e=f.length;if(!c.isStock()){return}if(e<7){this.elActAttach.show()}else{this.elActAttach.hide()}this.el.find(".j-act-remove")[e===1?"hide":"show"]()},chkRepeat:function(){var g=this.selects,h=g.slice(),j;h.sort();for(var f=0,e=h.length;f<e;f++){if(h[f]===h[f+1]){j="备货所在地不能重复";break}}h=null;if(j){this.showErr(j);return false}else{this.el.find(".j-item").find("select").removeAttr("disabled");this.el.find("a").css("color","").removeClass("disabled");this.hideErr();return true}},stockTypeChange:function(g,f){if(+f===1){this.el.find("select").attr("disabled",false);this.elActAttach.show()}else{this.clear();this.hideErr();this.el.find("select").attr("disabled",true);this.el.find(".j-act-remove").hide();this.elActAttach.hide()}},showErr:function(e){this.elErr.addClass("error-text").show().html(e)},hideErr:function(){this.elErr.removeClass("error-text").hide()}});b.SyiMoreInStock=a})(window.jQuery);(function(d){var a=window.SyiSale;var b=a.Tools;var c=DH.Base.create({elements:{".j-tab-prev":"elTabPrev",".j-tab-next":"elTabNext",".j-sku-tab":"elTab",".j-sku-tab-move":"elTabMove",".j-sku-tab-list":"elTabList",".j-sku-list":"elList"},events:{"click .j-tab-prev":"tabPrev","click .j-tab-next":"tabNext","change .j-select-status":"changeStatus","click .j-btn-batch-income":"batchIncome","change .j-input-batch-income":"singleBatchIncome","change .j-input-income":"singleIncome","click .j-btn-batch-stock":"batchStock","change .j-input-batch-stock":"singleStock","change .j-input-stock":"singleStock","click .j-btn-batch-period":"batchPeriod","change .j-input-period":"singlePeriod","change .j-input-batch-period":"singlePeriod","change .j-input-productcode":"singleProductCode","click .j-sku-tab .j-item":"clickTab"},tpl:{loading:'<div class="syiloadding" style="width:28px;height:28px;"></div>',tab:'<li class="j-item" data-code="<%=code%>"><a href="javascript:;"><span class="j-span-name"><%=name%></span></a></li>',item:'<div class="marginbottom10 stocking-inf-box clearfix j-item" data-code="<%=code%>" data-name="<%=name%>"><table><thead></thead><tbody></tbody></table></div>'},cgi:{getPrice:"/syi/preCalculate.do"},defaults:{status:{state:"show",head:"销售状态",body:' <select class="attr-select addwid70 j-select-status">                            <option value="1"<%=(status == 1 ? " selected" : "")%>>可销售</option>                            <option value="0"<%=(status != 1 ? "selected" : "")%>>不可销售</option>                        </select>                      '},income:{state:"show",head:' <span class="required">*</span> 实际收入                        <span data-helpid="skuPrice" title="销售价格帮助" class="helpicon"></span>                        <div class="clearfix j-batch-container">                            <input class="attr-text-input addwid30 marginright5 j-input-batch-income" type="text" />                            <span class="tourBtn j-btn-batch-income"><input value="批量设置" type="button"></span>                        </div>                      ',body:'US $ <input type="text" type="number" class="attr-text-input addwid50 colornamebox j-input-income<%=disabledClass%>" value="<%=price%>"<%=disabled%> /><span class="j-span-income" style="display:none;"><%=price%></span>/<span class="j-unit"><%=unit%></span>'},price:{state:"show",head:"买家价格",body:'<div class="j-div-price"></div>'},stock:{state:"show",head:' <span class="required">*</span> 备货数量                        <span data-helpid="stockNum" title="备货数量帮助" class="helpicon"></span>                        <div class="clearfix j-batch-container">                            <input class="attr-text-input addwid30 marginright5 j-input-batch-stock" type="text" />                            <span class="tourBtn j-btn-batch-stock"><input value="批量设置" type="button"></span>                        </div>                      ',body:'<input class="attr-text-input addwid60 colornamebox j-input-stock<%=disabledClass%>" type="text" value="<%=stock%>"<%=disabled%> />/<span class="j-unit"><%=unit%></span>'},period:{state:"show",head:' <span class="required">*</span> 备货期                        <div class="clearfix j-batch-container">                            <input class="attr-text-input addwid30 marginright5 j-input-batch-period" type="text" />                            <span class="tourBtn j-btn-batch-period"><input value="批量设置" type="button"></span>                        </div>                      ',body:'<input style="display:none;" class="attr-text-input addwid60 colornamebox j-input-period<%=disabledClass%>" value="<%=leadingtime%>" type="text"<%=disabled%> /><span class="j-span-period"><%=leadingtime%></span>天'},productcode:{state:"show",head:'商品编码<span data-helpid="skuCode" title="商品编码帮助" class="helpicon"></span>',body:'<input type="text" class="attr-text-input addwid140 colornamebox j-input-productcode<%=disabledClass%>" value="<%=skuCode%>"<%=disabled%> />'}},init:function(){this.isFirst=true;this.data={head:null,sku:{},noSku:true,length:0};this.noSkuDone=false;this.initTab();CustomEvent.bind("Standards.loadDefault",this.proxy(this.loadDefault));CustomEvent.bind("Standards.refresh",this.proxy(this.refresh));CustomEvent.bind("Standards.attrItemAdd",this.proxy(this.addSkuItem));CustomEvent.bind("Standards.attrItemDel",this.proxy(this.delSkuItem));CustomEvent.bind("syiSale.setPriceTypeChange",this.proxy(this.setSkuPriceStatus));CustomEvent.bind("syiSale.stockType.change",this.proxy(this.setSkuStockStatus));CustomEvent.bind("sku.more.attach",this.proxy(this.attachStock));CustomEvent.bind("sku.more.remove",this.proxy(this.removeStock));CustomEvent.bind("sku.more.change",this.proxy(this.changeStock));CustomEvent.bind("sku.more.unifyPeriodChange",this.proxy(this.setPeriodStatus))},initTab:function(){var e=0;this.tab={left:1,moveIndex:0,maxWidth:700};this.elTabMove.css({width:this.tab.maxWidth,overflow:"hidden","float":"left"});this.elTab.hide()},reset:function(){if(this.data.length===1){if(this.data.noSku){this.elTabList.empty();this.elList.empty();this.el.hide();this.data={head:null,sku:{},noSku:true,length:0};this.isFirst=true;this.noSkuDone=false}else{this.elTab.hide()}}},clear:function(){this.elTabList.find(".j-item").not(":first").remove();this.elTab.hide();this.elList.find(".j-item").not(":first").remove();this.data.length=1;this.activeTab(0);this.reset();CustomEvent.trigger("sku.totalStockNum.change")},create:function(f){this.elTabList.append(this.tmpl(this.tpl.tab,{code:f.code,name:f.name}));if(this.elList.find(".j-item").length>0){var e=this.elList.find(".j-item").eq(0).clone();e.attr("data-code",f.code).attr("data-name",f.name).find(".j-line").removeClass("disabled").end().find("input:text").attr("disabled",false).removeClass("inpdisabled").end().find(".j-input-stock, .j-input-batch-stock, .j-input-period, .j-input-batch-period, .j-input-productcode").val("").end().find(".j-span-period").text("").end().find("select").val(1).end().hide().appendTo(this.elList)}else{this.elList.append(this.tmpl(this.tpl.item,{code:f.code,name:f.name}))}this.data.length++;if(this.data.length>1){this.elTab.show()}else{this.elTab.hide()}},remove:function(e){this.elTab.find('.j-item[data-code="'+e.code+'"]').remove();this.elList.find('.j-item[data-code="'+e.code+'"]').remove();this.data.length--},first:function(){if(!this.isFirst){return}var e=b.getFirstStock();this.create(e);this.isFirst=false},attachStock:function(i,h,g){var f;this.first();this.create({code:h,name:g});this.el.show();this.setMoreStock();this.activeTab(0);this.fixedTab()},removeStock:function(h,g,f){this.remove({code:g});this.activeTab(0);this.reset();this.hideErr(g);this.fixedTab();CustomEvent.trigger("sku.totalStockNum.change")},activeTab:function(f){var g,e;if(f===0){f=this.elTab.find(".j-item:first").attr("data-code");this.elTabList.css("marginLeft",1);this.tab.left=1;this.tab.moveIndex=0}this.elTab.find(".j-item").removeClass("current");this.elList.find(".j-item").hide();g=this.elTab.find('.j-item[data-code="'+f+'"]');e=this.elList.find('.j-item[data-code="'+f+'"]');g.addClass("current");e.show();if(g.index()===0){e.find(".j-input-income").show().removeClass(".disabled");e.find(".j-span-income").hide();e.find(".j-input-batch-income").show();e.find(".j-btn-batch-income").show()}else{e.find(".j-input-income").hide().addClass(".disabled");e.find(".j-span-income").show();e.find(".j-input-batch-income").hide();e.find(".j-btn-batch-income").hide()}},clickTab:function(h){var f=d(h.currentTarget),g=f.attr("data-code");this.activeTab(g);return false},getTabName:function(f){var e=b.getFirstStock().el;return e.find('option[value="'+f+'"]').text()},_fixed:function(){if(this.tab.moveIndex===0){this.elTabPrev.addClass("grey").find("a").hide()}else{this.elTabPrev.removeClass("grey").find("a").show()}if(this.tab.moveIndex===this.data.length-1){this.elTabNext.addClass("grey").find("a").hide()}else{this.elTabNext.removeClass("grey").find("a").show()}},fixedTab:function(){var g=this.elTabList,e=g.outerWidth(),f=this.tab.maxWidth;if(e<f){this.elTabPrev.hide();this.elTabNext.hide()}else{this.elTabPrev.show();this.elTabNext.show();this._fixed()}},tabPrev:function(){var e=this.elTabPrev;if(e.hasClass("grey")){return}this.tabMove("left");return false},tabNext:function(){var e=this.elTabNext;if(e.hasClass("grey")){return}this.tabMove("right");return false},tabMove:function(j){var i=this.tab.left,g=this.tab.moveIndex,e,h,f;if(j==="left"){g--;e=this.elTabList.find(".j-item").eq(g);h=e.outerWidth(true);f=i+h;this.tab.moveIndex--}else{e=this.elTabList.find(".j-item").eq(g);h=e.outerWidth(true);f=i-h;this.tab.moveIndex++}this.tab.left=f;this.elTabList.css({marginLeft:f});this._fixed()},changeStock:function(j,i,h,g){var k=this.elTab.find('.j-item[data-code="'+i+'"]'),f=this.elList.find('.j-item[data-code="'+i+'"]');k.attr("data-code",h).find(".j-span-name").text(g);f.attr("data-code",h).attr("data-name",g);this.fixedTab();this.hideErr(i)},setMoreStock:function(){if(this.data.noSku===true&&this.noSkuDone===false){this.el.show();this.el.find("thead, tbody").empty();this.head({noSkuStatus:true});this.body({noSkuStatus:true});this.noSkuDone=true;this.el.find(".j-input-period").show();this.el.find(".j-span-period").hide();CustomEvent.trigger("sku.totalStockNum.change")}},loadDefault:function(g,f){this.backfill(f);if(f){this.setPriceList()}if(b.isSku()&&+b.ispromotion===1){this.disableChange()}},backfill:function(j){var l,s,p,n,e,q,k,r,g,f;if(!j||j.skuList.length===0){return}if(j.skuHead&&j.skuHead.length>0){this.data.noSku=false}else{this.data.noSku=true}p=j.skuHead;for(var h=0,o=j.skuList.length;h<o;h++){e=j.skuList[h].code;if(!e){e=b.getFirstStock().code}this.create({code:e,name:this.getTabName(e)});s=j.skuList[h].list;if(!l){n=s;this.head(p);this.body(n);l=true}else{q=this.elList.find('.j-item[data-code="'+e+'"]');for(k in s){f=s[k];r=q.find('.j-line[data-id="'+k+'"]');r.find(".j-select-status").val(f.status);r.find(".j-input-stock").val(f.stock);r.find(".j-input-period").val(f.leadingtime);r.find(".j-span-period").text(f.leadingtime);r.find(".j-input-productcode").val(f.skuCode);if(+f.status!==1){this.disableWith(r,true)}}}}this.activeTab(0);this.fixedTab();this.el.show();this.isFirst=false;if(b.isStock()&&this.data.length>1){this.noSkuDone=true}if(this.data.noSku&&this.data.length===1){this.el.hide();CustomEvent.trigger("sku.more.numchange",[0])}CustomEvent.trigger("sku.totalStockNum.change")},setPriceList:function(){var e=this,f=this._getPriceData(),g;d.post(this.cgi.getPrice,{isquickup:b.isquickup,catepubid:b.catePubId,skuList:JSON.stringify(f),priceSyiVersion:d("#priceSyiVersion").val()}).then(function(h){if(h&&+h.code===1000){for(var j in h.data){g=e.el.find('.j-line[data-id="'+j+'"]');e.setPriceWith(g.find(".j-div-price"),h.data[j].priceList)}}})},disableChange:function(){this.el.find(".j-select-status, .j-input-income, .j-input-batch-income").attr("disabled",true)},refresh:function(g,f){console.log(["刷新绘制"],"属性类目有退出或者新参与到排序中来");if(f===null){this.data.noSku=true;this.noSkuDone=false;if(this.data.length===1){this.el.find("thead, tbody").empty();this.el.hide()}else{this.setMoreStock()}this.data.sku={}}else{this.data.noSku=false;this.el.show();this.first();this.head(f.skuHead);this.refreshBody(f.skuList);this.el.find(".j-input-period").hide();this.el.find(".j-span-period").show()}CustomEvent.trigger("sku.totalStockNum.change")},refreshBody:function(e){this.el.find("tbody").empty();this.body(e)},head:function(i){var f=[],j=this.defaults,g,e;e=this.el.find("thead");if(!i.noSkuStatus){this.data.head=i;d(i).each(function(k,l){f.push("<th"+(l.attrId===9999?' width="100"':"")+">"+(l.lineAttrNameCn||l.lineAttrName)+"</th>")})}for(var h in j){g="j-"+h;f.push('<th class="'+g+'">'+j[h].head+"</th>")}e.html("<tr>"+f.join("")+"</tr>");f=null},body:function(l){var n=[],f=this.defaults,r=this.tmpl,s=this.getUnit(),h=this.el.find("tbody"),o,m,p,k,t,g,j,e;for(k in l){this.el.find('.j-line[data-id="'+k+'"]').length&&this.el.find('.j-line[data-id="'+k+'"]').remove();!o&&(o=this.el.find("tbody tr").length);m=o++%2?" trbgcolor":"";n.push('<tr class="j-line'+m+'" data-id="'+k+'">');if(!l.noSkuStatus){t=this.data.sku[k]=l[k];if(t.skuCode){t.skuCode=t.skuCode.replace(/\"/g,"&quot;")}d(t.attrList).each(function(i,v){var u=(v.lineAttrvalNameCn||v.lineAttrvalName||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;");u=u.length>16?u.replace(/(.{16})/g,"$1<br/>"):u;n.push("<td>"+u+"</td>")})}t=t||{};for(var q in f){e=f[q].body;e=e!==""?r(e,{status:t.status?t.status:"1",unit:s,price:t.price?t.price:"",stock:t.stock?t.stock:"",leadingtime:t.leadingtime?t.leadingtime:"",skuCode:t.skuCode?t.skuCode:"",disabled:t.status&&+t.status!==1?' disabled="disabled"':"",disabledClass:t.status&&+t.status!==1?" inpdisabled":""}):e;p="j-"+q;n.push('<td class="'+p+'">'+e+"</td>")}n.push("</tr>")}h.append(n.join(""));n=null;this.setSkuPriceStatusWith(b.isUnifyPrice()?"hide":"show");this.setSkuStockStatusWith(!b.isStock()?"hide":"show");this.setPeriodStatusWith(b.isUnifyPeriod()?"hide":"show");if(l.noSku===true||this.data.noSku===true){this.setSkuSaleStatusWith("hide");this.setBatchStatusWith("hide");this.el.find(".j-input-period").show();this.el.find(".j-span-period").hide()}this.elList.find(".j-item").not(":first").find(".j-input-income").hide().end().find(".j-span-income").show()},refreshListColor:function(){var e=this.el.find("tbody tr");e.each(function(f,h){var g=d(this);if((f+1)%2){g.removeClass("trbgcolor")}else{g.addClass("trbgcolor")}})},getUnit:function(){return b.getUnit.apply(b,arguments)},addSkuItem:function(g,f){console.log(["只做自增"],"选择某一属性一个选项不是唯一选中 只做自增处理");this.body(f)},delSkuItem:function(g,f){console.log(["只做删除"],"取消某一属性某一选项，此选项不是唯一选中 只做此属性相关的 节点删除工作");this.el.find(".j-line").filter(function(){return new RegExp(f).test(d(this).attr("data-id"))}).remove();this.refreshListColor();CustomEvent.trigger("sku.totalStockNum.change")},changeStatus:function(i){var g=d(i.currentTarget),h=g.closest(".j-line"),f=g.val();this.disableWith(h,+f===1?false:true)},disableWith:function(h,e){var f=h.closest(".j-item"),g=f.attr("data-code");h[e?"addClass":"removeClass"]("disabled").find("input").removeClass("error-text").attr("disabled",e)[e?"addClass":"removeClass"]("inpdisabled");this.hideErr(g)},batchIncome:function(j){var g=this,i=d(j.currentTarget),f=i.closest(".j-item"),l=f.find(".j-input-batch-income"),k=l.val(),h;if(this.chkIncome(l)){this.batchIncomeWith(f,k);h=this.el.find(".j-line").find(".j-div-price");this.setPriceLoading(h);this.getPrice(k).then(function(e){if(e&&+e.code===1000){g.setPriceWith(h,e.data.nonespec001.priceList)}})}},singleBatchIncome:function(f){this.chkIncome(d(f.currentTarget))},singleIncome:function(i){var f=this,h=d(i.currentTarget),j,g,k;if(this.chkIncome(h)){j=h.val();g=h.closest(".j-line").index();k=this.elList.find(".j-item");this.setPriceLoading(k.eq(0).find(".j-line").eq(g).find(".j-div-price"));this.getPrice(j).then(function(e){if(e&&+e.code===1000){k.each(function(){var l=d(this).find(".j-line").eq(g);l.find(".j-input-income").val(j);f.setPriceWith(l.find(".j-span-income"),j);f.setPriceWith(l.find(".j-div-price"),e.data.nonespec001.priceList)})}})}},batchIncomeWith:function(e,f){this.el.find(".j-input-income").removeClass("error-text").not(":disabled").val(f);this.el.find(".j-span-income").text(f)},getPrice:function(f,e){return d.post(this.cgi.getPrice,{noSpecPrice:f,catepubid:b.catePubId,skuList:JSON.stringify(e||[{price:f}]),priceSyiVersion:d("#priceSyiVersion").val()})},setPriceLoading:function(e){e.html(this.tpl.loading)},setPriceWith:function(e,f){e.html(f)},batchStock:function(h){var g=d(h.currentTarget),f=g.closest(".j-item"),j=f.find(".j-input-batch-stock"),i=j.val();if(this.chkStock(j)){this.batchStockWith(f,i);CustomEvent.trigger("sku.totalStockNum.change")}},singleStock:function(h){var f=d(h.currentTarget),g=f.val();if(this.chkStock(f)){CustomEvent.trigger("sku.totalStockNum.change"),[g]}},batchStockWith:function(e,f){e.find(".j-line").not(".disabled").find(".j-input-stock").removeClass("error-text").val(f)},batchPeriod:function(h){var g=d(h.currentTarget),f=g.closest(".j-item"),j=f.find(".j-input-batch-period"),i=j.val();if(this.chkPeriod(j)){this.batchPeriodWith(f,i)}},singlePeriod:function(f){this.chkPeriod(d(f.currentTarget))},batchPeriodWith:function(e,f){var g=e.find(".j-line").not(".disabled");g.find(".j-input-period").val(f);g.find(".j-span-period").text(f)},singleProductCode:function(f){this.chkProductCode(d(f.currentTarget))},setSkuPriceStatus:function(g,f){this.setSkuPriceStatusWith(+f===1?"show":"hide");this.hideAllErr()},setSkuPriceStatusWith:function(e){this.el.find(".j-income")[e](),this.el.find(".j-price")[e]()},setSkuStockStatus:function(g,f){if(+f===1){this.setSkuStockStatusWith("show")}else{this.clear();this.setSkuStockStatusWith("hide")}this.hideAllErr()},setSkuStockStatusWith:function(e){this.el.find(".j-stock")[e]()},setPeriodStatus:function(g,f){this.setPeriodStatusWith(+f===1?"show":"hide");this.hideAllErr()},setPeriodStatusWith:function(e){this.el.find(".j-period")[e]()},setSkuSaleStatusWith:function(e){this.el.find(".j-status")[e]()},setBatchStatusWith:function(e){this.el.find(".j-batch-container")[e]()},_getData:function(){var m=this,n=[],h=this.elList.find(".j-item"),j=b.isStock(),g=b.getFirstUnityPrice(),l=b.isUnifyPrice(),k=b.isUnifyPeriod(),f=b.getUnifyPeriod();if(!this.data.noSku||this.data.length>1){h.each(function(){var q=d(this),o=q.attr("data-code"),p=[];q.find(".j-line").each(function(){var r=d(this),s=r.attr("data-id");p.push({"class":"#",attrList:m.getPriceListItemId(s),status:r.find(".j-select-status").val(),price:l?g:r.find(".j-input-income").val(),stock:j?r.find(".j-input-stock").val():"0",skuCode:r.find(".j-input-productcode").val(),id:s||"noSKu"})});if(!k){f=q.find(".j-line").not(".disabled").eq(0).find(".j-input-period").eq(0).val()}n.push({"class":"###",inventoryLocation:o,leadingTime:+f,skuInfoList:p})})}else{if(j){var e=b.getFirstStock().code,i=[];i.push({"class":"#",attrList:[],status:"1",price:g,stock:b.getOriginStockNum(),skuCode:b.getOriginSkuCode(),id:"noSku"});n.push({"class":"###",inventoryLocation:e,leadingTime:+f,skuInfoList:i})}}return n},getData:function(){if(!this.chkAll()){return}return this._getData()},setData:function(){d("#proSkuInfo").val(JSON.stringify(this._getData()))},getPriceListItemId:function(l){var j=/(\d+_\d+)/g,g,f,k=[],e,h,m=l.match(j);if(m!=null&&typeof m!=="undefined"){for(g=0,f=m.length;g<f;g++){h=m[g].split("_");e={};e.attrId=h[0];e.attrVid=h[1];e.type="1";e["class"]="##",k.push(e)}}return k},_getPriceData:function(){var e=[],f;f=this.elList.find(".j-item:first");f.find(".j-line").each(function(){e.push({id:d(this).attr("data-id"),price:d(this).find(".j-input-income").val()})});return e},getPriceData:function(){if(!this.chkAll()){return}return this._getPriceData()},chkAll:function(){var f=this,g=this.el.is(":visible"),e=true;if(g){if(!b.isUnifyPrice()){this.elList.find(".j-input-income").not(".disabled").not(":disabled").each(function(){if(!f.chkIncome(d(this))){e=false;return false}})}if(e&&b.isStock()){this.elList.find(".j-input-stock").not(":disabled").each(function(){if(!f.chkStock(d(this))){e=false;return false}})}if(e&&!b.isUnifyPeriod()){this.elList.find(".j-input-period").not(":disabled").each(function(){if(!f.chkPeriod(d(this))){e=false;return false}})}if(e){this.elList.find(".j-input-productcode").not(":disabled").each(function(){if(b.trim(d(this).val())!==""&&!f.chkProductCode(d(this))){e=false;return false}})}}return e},chkIncome:function(g){if(!g){return}var e=g.closest(".j-item"),j=e.attr("data-code"),f=e.attr("data-name"),k=g.val(),i=b.cateMinPrice,h;if(b.isEmpty(k)||!b.isPrice(k)||+k<+i){h="价格必须为数字,最多允许两位小数。"+i+"-999999"}if(h){g.addClass("error-text");this.showErr(j,f,h);return false}else{g.removeClass("error-text");this.hideErr(j);return true}},chkStock:function(g){if(!g){return}var e=g.closest(".j-item"),i=e.attr("data-code"),f=e.attr("data-name"),j=g.val(),h;if(b.isEmpty(j)||!b.isInteger(j)){h="库存数应该为数字,介于1~10000之间"}if(h){g.addClass("error-text");this.showErr(i,f,h);return false}else{g.removeClass("error-text");this.hideErr(i);return true}},chkPeriod:function(g){if(!g){return}var e=g.closest(".j-item"),i=e.attr("data-code"),f=e.attr("data-name"),j=g.val(),h;if(b.isEmpty(j)||!b.isInteger(j)||+j<1||+j>2){h="备货期必须为整数数字,且必须小于等于2天"}if(h){g.addClass("error-text");this.showErr(i,f,h);return false}else{g.removeClass("error-text");this.hideErr(i);return true}},chkProductCode:function(g){if(!g){return}var e=g.closest(".j-item"),i=e.attr("data-code"),f=e.attr("data-name"),j=g.val(),h;if(b.isEmpty(j)||!b.isProductCode(j)){h="商品编码不能有中文及特殊字符,长度不能超过40字符"}if(h){g.addClass("error-text");this.showErr(i,f,h);return false}else{g.removeClass("error-text");this.hideErr(i);return true}},showErr:function(f,e,h){var g;if((g=this.el.find(".j-error-"+f)).length===0){g=d('<div class="tip-error j-error-'+f+'"></div>');this.el.append(g)}if(this.data.length>1){h="备货地"+e+"："+h}g.addClass("error-text").show().html(h)},hideErr:function(e){this.el.find(".j-error-"+e).removeClass("error-text").hide()},hideAllErr:function(){this.el.find(".tip-error").removeClass("error-text").hide()}});a.SyiSku=c})(window.jQuery);(function(e){var b=window.SyiSale;var c=b.Tools;var d=DH.Base.create({elements:{".j-section-list":"elList",".j-section-add":"elAdd",".j-tip-error":"elErr"},events:{"click .j-section-add":"addNew","click .j-section-del":"del","change .j-section-stock":"changeStock","change .j-section-price":"changeIncome"},conf:{max:4},tpl:{item:'<p class="j-item">                        <input type="text" value="<%=num%>" class="attr-text-input addwid50 margindoublev5 j-section-stock">                        <span class="marginright20"><span class="j-unit"><%=unit%></span>以上</span>                        实际收入：US$                        <input type="text" value="<%=discount%>" class="attr-text-input addwid50 margindoublev5 j-section-price">                        <span class="marginright20">/<span class="j-unit"><%=unit%></span></span>                        买家价格： US$ <span class="j-section-salePrice"></span>                         <a href="#" class="j-section-del" style="display: none;">删除</a>                    </p>'},errors:{stock:{empty:"请输入购买数量",integer:"购买数量应该为整数数字,且不能大于10000",small:"价格区间的购买数量小于上个区间的购买数量"},price:{empty:"请输入价格",price:"价格必须为数字,最多允许两位小数。0.01-999999",big:"价格区间的价格必须依次递减。"}},cgi:{getPrice:"/syi/preCalculate.do"},init:function(){this.currentNum=0;this.maxNum=this.conf.max;this.addNew();this.errorMsgs=null},disableChange:function(){if(+c.ispromotion===1){this.el.find("input, a").attr("disabled",true)}},backfill:function(i){var h=this;if(!i||!i.length){return}this.clear();e(i).each(function(j,k){h.add(k)});this.getPrice(i);this.disableChange()},clear:function(){this.currentNum=0;this.elList.empty()},addNew:function(){if(this.elAdd.attr("disabled")==="true"){return false}this.add();return false},add:function(j){var h=this.elList,i=c.getUnit();if(this.currentNum===this.maxNum){return}h.find(".j-item:last").find(".j-section-del").hide();!j&&(j={startqty:this.currentNum===0?1:"",discount:""});h.append(this.tmpl(this.tpl.item,{num:j.startqty,discount:j.discount,unit:i}));this.currentNum++;if(this.currentNum>1){h.find(".j-item:last").find(".j-section-del").show()}this.currentNum===this.maxNum&&this.elAdd.hide()},del:function(k){var j=e(k.currentTarget),h=j.closest(".j-item"),i=this.elList;if(j.attr("disabled")==="true"){return false}h.remove();this.currentNum--;if(this.currentNum>1){i.find(".j-item:last").find(".j-section-del").show()}this.currentNum===this.maxNum-1&&this.elAdd.show();this.chkAllUnifyPrice();return false},changeStock:function(){var h=this.getData();if(h){this.getPrice(h)}},changeIncome:function(){var h=this.getData();if(h){this.getPrice(h)}},_getData:function(){var h=[];this.el.find(".j-item").each(function(){var j=e(this).find(".j-section-stock"),i=e(this).find(".j-section-price");h.push({startqty:j.val(),discount:i.val()})});return h},getData:function(){if(!this.chkAllUnifyPrice()){return}return this._getData()},getCacheData:function(){return this._getData()},getPrice:function(i){var h=this.el;e.post(this.cgi.getPrice,{priceSyiVersion:e("#priceSyiVersion").val(),noSpecPrice:0,catepubid:c.catePubId,sectionList:JSON.stringify(i)}).then(function(j){if(j&&+j.code===1000){e(j.data.nonespec001.priceList).each(function(k,l){h.find(".j-section-salePrice").eq(k).text(l.realIncome)})}else{console.log("【统一设置价格】网络出现问题，收入计算失败，请稍后重试")}})},chkStockWith:function(j){var i=j.closest(".j-item"),h,l=j.val(),m=this.errors.stock,k;if(c.isEmpty(l)){k=m.empty}else{if(!c.isInteger(l)||+l<1){k=m.integer}else{if((h=i.prev(".j-item")).length&&+l<=+h.find(".j-section-stock").val()){k=m.small}}}if(k){j.addClass("error-text");this.errorMsgs.push(k)}else{j.removeClass("error-text")}},chkPriceWith:function(j){var i=j.closest(".j-item"),h,l=j.val(),m=this.errors.price,k;if(c.isEmpty(l)){k=m.empty}else{if(!c.isPrice(l)||+l<0.01||+l>999999){k=m.price}else{if((h=i.prev(".j-item")).length&&+l>=+h.find(".j-section-price").val()){k=m.big}}}if(k){j.addClass("error-text");this.errorMsgs.push(k)}else{j.removeClass("error-text")}},chkAllUnifyPrice:function(){var h=this,i;this.errorMsgs=[];this.el.find(".j-item").each(function(){var k=e(this).find(".j-section-stock"),j=e(this).find(".j-section-price");h.chkStockWith(k);h.chkPriceWith(j)});if((i=this.el.find(".error-text").length)>0){this.elErr.show().html(this.errorMsgs[0])}else{this.elErr.hide()}return i===0}});var a=DH.Base.create({elements:{".j-section-list":"elList",".j-section-add":"elAdd",".j-tip-error":"elErr"},events:{"click .j-section-add":"addNew","click .j-section-del":"del","change .j-section-stock":"chkAllDiscountPrice","change .j-section-discount":"chkAllDiscountPrice"},conf:{max:4},tpl:{defaultItem:'<p class="j-item">                                购买                                <input type="text" value="<%=num%>" class="attr-text-input addwid50 margindoublev5 j-section-stock">                                <span class="j-unit"><%=unit%></span>及以上时，为表格中填写的实际收入。                            </p>',item:'<p class="margintop10 j-item">                        购买                        <input type="text" class="attr-text-input addwid50 margindoublev5 j-section-stock" name="startqty" value="<%=num%>">                        <span class="j-unit">件</span>及以上时，实际收入降低                        <input type="text" class="attr-text-input addwid50 margindoublev5 j-section-discount" value="<%=discount%>" name="discount">%。                          <a href="#" class="j-section-del" style="display: none;">删除</a>                    </p>'},errors:{stock:{empty:"请输入购买数量",integer:"购买数量应该为整数数字,且不能大于10000",small:"价格区间的购买数量小于上个区间的购买数量"},discount:{empty:"请输入折扣",discount:"折扣应该为1-99的整数",small:"折扣不能小于上一区间折扣"}},init:function(){this.currentNum=0;this.maxNum=this.conf.max;this.addNew();this.disableChange();this.errorMsgs=null},disableChange:function(){if(+c.ispromotion===1){this.el.find("input, a").attr("disabled",true)}},backfill:function(i){var h=this;if(!i||!i.length){return}this.clear();e(i).each(function(j,k){h.add(k)})},clear:function(){this.currentNum=0;this.elList.empty()},addNew:function(){if(this.elAdd.attr("disabled")==="true"){return false}this.add();return false},add:function(j){var h=this.elList,i=c.getUnit();if(this.currentNum===this.maxNum){return}h.find(".j-item:last").find(".j-section-del").hide();!j&&(j={startqty:this.currentNum===0?1:"",discount:""});if(this.currentNum===0){h.append(this.tmpl(this.tpl.defaultItem,{num:j.startqty,unit:i}))}else{h.append(this.tmpl(this.tpl.item,{num:j.startqty,discount:j.discount,unit:i}))}this.currentNum++;if(this.currentNum>1){h.find(".j-item:last").find(".j-section-del").show()}this.currentNum===this.maxNum&&this.elAdd.hide()},del:function(k){var j=e(k.currentTarget),h=j.closest(".j-item"),i=this.elList;if(j.attr("disabled")==="true"){return false}h.remove();this.currentNum--;if(this.currentNum>1){i.find(".j-item:last").find(".j-section-del").show()}this.currentNum===this.maxNum-1&&this.elAdd.show();this.chkAllDiscountPrice();return false},_getData:function(){var h=[];this.el.find(".j-item").each(function(){var j=e(this).find(".j-section-stock"),i=e(this).find(".j-section-discount");h.push({startqty:j.val(),discount:i.val()||"0"})});return h},getData:function(){if(!this.chkAllDiscountPrice()){return}return this._getData()},getCacheData:function(){return this._getData()},chkStockWith:function(j){var i=j.closest(".j-item"),h,l=j.val(),m=this.errors.stock,k;if(c.isEmpty(l)){k=m.empty}else{if(!c.isInteger(l)||+l<1){k=m.integer}else{if((h=i.prev(".j-item")).length&&+l<=+h.find(".j-section-stock").val()){k=m.small}}}if(k){j.addClass("error-text");this.errorMsgs.push(k)}else{j.removeClass("error-text")}},chkDiscountWith:function(j){var i=j.closest(".j-item"),h,l=j.val(),m=this.errors.discount,k;if(c.isEmpty(l)){k=m.empty}else{if(!c.isInteger(l)||+l<1||+l>99){k=m.discount}else{if((h=i.prev(".j-item")).length&&+l<=+h.find(".j-section-discount").val()){k=m.small}}}if(k){j.addClass("error-text");this.errorMsgs.push(k)}else{j.removeClass("error-text")}},chkAllDiscountPrice:function(){var h=this,i;this.errorMsgs=[];this.el.find(".j-item").each(function(){var k=e(this).find(".j-section-stock"),j=e(this).find(".j-section-discount");k.length&&h.chkStockWith(k);j.length&&h.chkDiscountWith(j)});if((i=this.el.find(".error-text").length)>0){this.elErr.show().html(this.errorMsgs[0])}else{this.elErr.hide()}return i===0}});var f=DH.Base.create({tpl:{box:'  <div class="syi-pop-title4"><%=sectionStr%></div>                    <div class="noshade-pop-inner">                        <div class="popglobaltable <%=className%>">                            <table>                                <thead><%=headStr%></thead>                                <tbody><%=listStr%></tbody>                            </table>                        </div>                    </div>                    <div class="align-center pop-button clearfix" style="margin:10px auto;"><span class="yellowBtn valmiddle j-dialog-closer"><input type="button" value="关闭"></span></div>',item:"<p>购买<%=sectionStr%>时，实际收入降低<b><%=discount%>%</b>。</p>"},init:function(){e(document.body).append('<div><div class="j-dialog-loading" style="display:none;width:900px;"><div class="syiloadding"></div></div><div class="j-dialog-previewprice" style="display:none;width:900px;"></div></div>')},render:function(j,h){var i=e(".j-dialog-previewprice");i.html(this.getContent(j,h))},getContent:function(i,h){return this.tmpl(this.tpl.box,{sectionStr:this.getPriceInfoTopStr(i),headStr:this.getPriceInfoTheadStr(i),listStr:this.getPriceInfoTbodyStr(i),className:h?"addpopauto":""})},getPriceInfoTopStr:function(p){var m,j,h,l=[],o=p.list.section,n=c.getUnit(),k;if(o){for(m=0,j=o.length;m<j;m++){h=o[m];if(h.endqty){k=["<b>",h.startqty,"-",h.endqty,"</b>",n].join("")}else{k=["<b>",h.startqty,"</b>",n,$L("syi_msg_andOver")].join("")}h.sectionStr=k;l.push(this.tmpl(this.tpl.item,h))}}return l.join("")},getPriceInfoTheadStr:function(k){var m=k.head,l,h,j=c.getUnit(),i=["<tr>"];for(l in m){h=m[l];if(h){i.push("<th>"+h.lineAttrNameCn||h.lineAttrName+"</th>")}}i.push(["<th>","购买区间","</th><th>","实际收入","</th><th>","买家价格","</th></tr>"].join(""));return i.join("")},getPriceInfoTbodyStr:function(C){var u,C,k,B,t,m=[],h,x,p,v,l,q=c.getUnit(),A=C.list,r=C.sku;A=e.extend({},A);delete A.section;for(u in A){h=["<tr>"];x=[];p=[];l=[];k=A[u];v=k.price;t=r[u]?r[u]["attrList"]:[];for(var w=0,s=t.length;w<s;w++){h.push("<td>"+t[w]["lineAttrvalName"]+"</td>")}for(var y=0,z=k.priceList.length;y<z;y++){B=k.priceList[y];var n=B.endqty?"-"+(B.endqty):"+";x.push("<p>"+B.startqty+n+"</p>");p.push("<p>US $"+B.wholesalePrice+"/"+q+"</p>");l.push("<p>US $"+B.realIncome+"/"+q+"</p>")}h=h.concat(["<td>",x.join('<span class="splitLine"></span>'),"</td><td>",p.join('<span class="splitLine"></span>'),"</td><td>",l.join('<span class="splitLine"></span>'),"</td></tr>"]);m=m.concat(h)}return m.join("")}});var g=DH.Base.create({elements:{".j-select-unit":"elSelectUnit",".j-sale-bao":"elSaleBao","#packquantity":"elPackQuantity",'input[name="maxSaleQty"]':"elMaxSaleQty",".j-stock-input":"elStockInput",'input[name="inventory"]':"elStockNum",".j-stock-box":"elStockBox",".j-stock-totalnum":"elStockTotalNum",".j-period-box":"elPeriodBox",".j-set-unifyperiod-container":"elUnifyPeriodContainer",".j-set-unifyperiod":"elUnifyPeriod",'input[name="proLeadingtime"]':"elPeriod",".j-leadingtime-tip":"elPeriodTip",".j-goodcode-box":"elGoodCodeBox",".j-price-typeList":"elPriceTypeList",".j-sectionA-box":"elUnifyPriceBox",".j-sectionB-box":"elDiscountBox",'input[name="skuCode"]':"elProductCode",'.tip-error[data-id="tips-packquantity"]':"errPackQuantity",'.tip-error[data-id="tips-maxSaleQty"]':"errMaxSaleQty",'.tip-error[data-id="j-saleBox"]':"errSaleBox",'.tip-error[data-id="tips-leadingtime"]':"errPeriod",'.tip-error[data-id="tips-skucode"]':"errProductCode"},events:{'click input[name="sortby"]':"clickSoryBy",'click input[name="inventoryStatus"]':"clickInventoryStatus","change #packquantity":"changePackQuantity",'change input[name="maxSaleQty"]':"changeMaxSaleQty",'change input[name="inventory"]':"changeStockNum","click .j-set-unifyperiod":"clickUnifyPeriod",'change input[name="proLeadingtime"]':"changePeriod",'click input[name="setdiscounttype"]':"clickSetDiscountType",'change input[name="skuCode"]':"changeProductCode","click .j-price-previewBtn":"previewPrice","change .j-select-unit":"changeUnit","mouseenter .j-price-tipstxt .tipstion":"showTipstion","mouseleave .j-price-tipstxt .tipstion":"hideTipstion"},cgi:{previewPrice:"/syi/preCalculate.do"},tpl:{tips:{commission:'订单金额US$<%=price%>以下,佣金为<%=rate_max%>% 订单金额US$<%=price%>以上,佣金率为<%=rate_min%>%<div class="tiparrow-b" style="left:144px;"></div>'}},init:function(){var h=this;this.sortBy=null;this.hasSku=c.isSku();this.hasMoreStockArea=false;this.commissionRate=e("#commissionRate").val().split(",");this.initEvents();e(function(){h.initUnit();h.initSortBy();h.initInventoryStatus();h.initUnifyPeriod();h.initPriceTypeListStatus();h.initDiscountType();h.disableChange()})},initUnit:function(){var h=this.elSelectUnit.find("option:selected").attr("data-name");this.changeUnitWith(h)},initSortBy:function(){var h=+this.el.find('input[name="sortby"]:checked').val();this.sortByWith(h)},initInventoryStatus:function(){var h=+this.el.find('input[name="inventoryStatus"]:checked').val();this.inventoryStatusWith(h)},initUnifyPeriod:function(){var h=+this.elPeriod.val();this.el.find(".j-set-unifyperiod").attr("checked",h>0);this.elPeriod.attr("disabled",h===0)},initPriceTypeListStatus:function(){if(!this.hasSku&&!this.hasMoreStockArea){this.setPriceTypeListStatusWith("hide")}},initDiscountType:function(){var h=+this.el.find('input[name="setdiscounttype"]:checked').val();this.setDiscountType(h)},initEvents:function(){var h=this,i;this.unifyPrice=new d({el:this.elUnifyPriceBox});this.discountPrice=new a({el:this.elDiscountBox});i=e.parseJSON(e("#saleSectionData").val()||"[]");if(c.isUnifyPrice()){this.unifyPrice.backfill(i)}else{this.discountPrice.backfill(i)}this.moreInStock=new b.SyiMoreInStock({el:".j-moreinstock-container"});this.sku=new b.SyiSku({el:".j-sku-container"});this.priceView=new f();this.previewDialog=new DH.Widget.Dialog();CustomEvent.bind("sku.more.numchange",function(k,j){if(j===1){h.hasMoreStockArea=true;h.setUnifyPeriodStatusWith("show");h.setStockNumStatusWith("hide");if(c.isStock()){h.setTotalStockStatusWith("show")}h.setGoodCodeStatusWith("hide")}else{h.hasMoreStockArea=false;h.elUnifyPeriod.attr("checked",true);h.changeUnifyPeriod(true);h.setUnifyPeriodStatusWith("hide");if(c.isStock()&&!h.hasSku){h.setStockNumStatusWith("show");h.setTotalStockStatusWith("hide")}if(!h.hasSku){h.setGoodCodeStatusWith("show")}else{h.setGoodCodeStatusWith("hide")}}});CustomEvent.bind("Standards.refresh",function(k,j){if(j){h.hasSku=true;h.setStockNumStatusWith("hide");if(c.isStock()){h.setTotalStockStatusWith("show")}h.setGoodCodeStatusWith("hide");h.setPriceTypeListStatusWith("show")}else{h.hasSku=false;if(c.isStock()&&!h.hasMoreStockArea){h.setStockNumStatusWith("show");h.setTotalStockStatusWith("hide")}if(!h.hasSku&&!h.hasMoreStockArea){h.setGoodCodeStatusWith("show")}else{h.setGoodCodeStatusWith("hide")}h.setPriceTypeListStatusWith("hide");h.el.find('input[name="setdiscounttype"]:first').attr("checked",true);h.setDiscountType(2)}});CustomEvent.bind("sku.totalStockNum.change",this.proxy(this.changeTotalStockNum));CustomEvent.bind("sku.fixedErrorSkuData",this.proxy(this.fixedErrorSkuData));if(window.G_EVENT){window.G_EVENT.bind("setSyiSaleInfo",this.proxy(this.chkSyiSaleInfo));window.G_EVENT.bind("draftbox-save",this.proxy(this.saveForDraftBox))}this.fixedModPrice()},disableChange:function(){if(+c.ispromotion===1){this.elSelectUnit.attr("disabled",true);this.el.find('input[name="sortby"]').attr("disabled",true);this.el.find('input[name="setdiscounttype"]').attr("disabled",true)}},enableChange:function(){if(+c.ispromotion===1){this.elSelectUnit.removeAttr("disabled");this.el.find('input[name="sortby"]').removeAttr("disabled");this.el.find('input[name="setdiscounttype"]').removeAttr("disabled")}},fixedModPrice:function(){var h=this;e("#sku_form").submit(function(){e("#customAttrList").val(e("#div_customattrlist").text());return h.chkSyiSaleInfo()})},fixedErrorSkuData:function(){var h;if(!c.isSku()){h=this.el.find('input[name="setdiscounttype"]').eq(0);if(h.attr("checked")!==true){h.attr("checked",true);this.setDiscountType(2)}this.setPriceTypeListStatusWith("hide")}},changeUnit:function(j){var h=e(j.currentTarget),i=h.find("option:selected").attr("data-name");this.changeUnitNoWith(i);this.sortBy===1&&this.changeUnitWith(i)},changeUnitNoWith:function(h){this.el.find(".j-unit-no").text(h)},changeUnitWith:function(h){this.el.find(".j-unit").text(h)},clickSoryBy:function(j){var h=e(j.currentTarget),i=h.val();this.sortByWith(i)},sortByWith:function(h){this.sortBy=+h;if(+h===2){+this.elPackQuantity.val()===1&&this.elPackQuantity.val(2);this.changeUnitWith("包");this.elSaleBao.show()}else{this.elPackQuantity.val(1);this.changeUnitWith(this.elSelectUnit.find("option:selected").attr("data-name"));this.elSaleBao.hide();this.hideErr(this.errPackQuantity)}},changePackQuantity:function(){this.chkQuantity()},clickInventoryStatus:function(j){var h=e(j.currentTarget),i=h.val();this.inventoryStatusWith(+i)},inventoryStatusWith:function(h){if(h===1){if(this.hasSku||this.hasMoreStockArea){this.setStockNumStatusWith("hide");this.setTotalStockStatusWith("show")}else{this.setStockNumStatusWith("show");this.setTotalStockStatusWith("hide")}this.elMaxSaleQty.attr("disabled",true);this.hideErr(this.errMaxSaleQty);this.elPeriodTip.text("有备货的产品备货期小于等于2天")}else{this.setStockNumStatusWith("hide");this.setTotalStockStatusWith("hide");this.hideErr(this.errSaleBox);this.elMaxSaleQty.attr("disabled",false);this.elUnifyPeriod.attr("checked",true);this.changeUnifyPeriod(true);this.setUnifyPeriodStatusWith("hide");this.elPeriodTip.text("无备货的产品需在1-60天内发货")}CustomEvent.trigger("syiSale.stockType.change",[h])},changeMaxSaleQty:function(){this.chkMaxSaleQty()},changeStockNum:function(){this.chkStockNum()},clickUnifyPeriod:function(j){var i=e(j.currentTarget),h=i.attr("checked");this.changeUnifyPeriod(h)},changeUnifyPeriod:function(h){this.elPeriod.attr("disabled",!h);this.hideErr(this.errPeriod);CustomEvent.trigger("sku.more.unifyPeriodChange",+!h)},changePeriod:function(){this.chkPeriod()},changeProductCode:function(){this.chkProductCode()},changeTotalStockNum:function(l,i){var h=this.elStockTotalNum,k=+h.val(),j=0;if(i&&+i>0){h.text(k+i)}else{this.el.find(".j-input-stock").each(function(){var n=e(this),m=n.val();if(c.isInteger(m)){j+=+m}n=m=null});h.text(j)}},clickSetDiscountType:function(j){var h=e(j.currentTarget),i=+h.val();this.setDiscountType(i)},setDiscountType:function(h){if(h===1){this.elUnifyPriceBox.hide();this.elDiscountBox.show()}else{if(h===2){this.elUnifyPriceBox.show();this.elDiscountBox.hide()}}CustomEvent.trigger("syiSale.setPriceTypeChange",[h])},setStockNumStatusWith:function(h){this.elStockInput[h]()},setUnifyPeriodStatusWith:function(h){this.elUnifyPeriodContainer[h]()},setPeriodStatusWith:function(h){this.elPeriodBox[h]()},setTotalStockStatusWith:function(h){this.elStockBox[h]()},setGoodCodeStatusWith:function(h){this.elGoodCodeBox[h]()},setPriceTypeListStatusWith:function(h){this.elPriceTypeList[h]()},previewPrice:function(){var i=this.priceView,h=this.previewDialog,n=this.sku,k=this.discountPrice.getData(),m=n.getPriceData(),j={},l;if(k&&m){this.previewDialog.html(".j-dialog-loading",{title:"价格预览"});l=m.length*k.length;e.post(this.cgi.previewPrice,{status:true,isquickup:c.isquickup,catepubid:c.catePubId,skuList:JSON.stringify(m),listLength:l,priceSyiVersion:e("#priceSyiVersion").val(),sectionList:JSON.stringify(k)}).then(function(o){if(o&&+o.code===1000){j=e.extend(j,{list:o.data,head:n.data.head,sku:n.data.sku});h.html(".j-dialog-previewprice",{title:"价格预览"});i.render(j,l>9);h.reset()}})}return false},chkQuantity:function(){var h=this.elPackQuantity,j=h.val(),i;if(c.isUnitSale()){return true}if(c.isEmpty(j)||!c.isInteger(j)||+j<2){i="产品数量应该为整数数字且不能小于2"}if(i){this.showErr(this.errPackQuantity,i);return false}else{this.hideErr(this.errPackQuantity);return true}},chkMaxSaleQty:function(){var h=this.elMaxSaleQty,j=h.val(),i;if(c.isStock()){return true}if(c.isEmpty(j)||!c.isInteger(j)||+j>10000){i="购买数量应该为整数数字,且不能大于10000"}if(i){this.showErr(this.errMaxSaleQty,i);return false}else{this.hideErr(this.errMaxSaleQty);return true}},chkStockNum:function(){var h=this.elStockNum,j=h.val(),i;if(h.is(":hidden")){return true}if(c.isEmpty(j)||!c.isInteger(j)||+j>10000){i="库存数应该为数字,介于1~10000之间"}if(i){this.showErr(this.errSaleBox,i);return false}else{this.hideErr(this.errSaleBox);return true}},chkPeriod:function(){var i=this.elPeriod,k=i.val(),h,j;if(i.is(":hidden")||!c.isUnifyPeriod()){return true}if(c.isStock()){h=2}else{h=60}if(c.isEmpty(k)||!c.isInteger(k)||+k>h){j="备货期必须为整数数字,且必须小于等于"+h+"天"}if(j){this.showErr(this.errPeriod,j);return false}else{this.hideErr(this.errPeriod);return true}},chkProductCode:function(){var h=this.elProductCode,j=h.val(),i;if(h.is(":hidden")||e.trim(j)===""){return true}if(c.isEmpty(j)||!c.isProductCode(j)){i="商品编码不能有中文及特殊字符,长度不能超过40字符"}if(i){this.showErr(this.errProductCode,i);return false}else{this.hideErr(this.errProductCode);return true}},chkSyiSaleInfo:function(){var h=true,i=c.isUnifyPrice();h=this.chkQuantity()&&h;h=this.chkMaxSaleQty()&&h;h=this.moreInStock.chkRepeat()&&h;h=this.chkStockNum()&&h;h=this.chkPeriod()&&h;h=this.sku.chkAll()&&h;h=this.chkProductCode()&&h;if(i){e("#noSpecPrice").val(c.getFirstUnityPrice());h=this.unifyPrice.chkAllUnifyPrice()&&h}else{h=this.discountPrice.chkAllDiscountPrice()&&h}if(!h){window.showErrorTip&&window.showErrorTip("saleinfo","产品销售信息错误")}else{this.setData()}return h},showTipstion:function(i){var h=e(i.currentTarget),j=h.find(".tiparrow-posbox");j.show().find(".tiparrow-box").html(this.tmpl(this.tpl.tips.commission,{price:this.commissionRate[2],rate_min:parseFloat(this.commissionRate[1]*100).toFixed(2),rate_max:parseFloat(this.commissionRate[0]*100).toFixed(2)}))},hideTipstion:function(i){var h=e(i.currentTarget),j=h.find(".tiparrow-posbox");j.hide()},showErr:function(h,i){h.addClass("error-text").show().html(i)},hideErr:function(h){h.removeClass("error-text").hide()},setData:function(){if(c.isUnifyPrice()){e("#saleSectionData").val(JSON.stringify(this.unifyPrice.getCacheData()))}else{e("#saleSectionData").val(JSON.stringify(this.discountPrice.getCacheData()))}this.sku.setData();+c.ispromotion===1&&this.enableChange()},saveForDraftBox:function(){this.setData()}});new g({el:".j-sale-container"})})(window.jQuery);(function(e){var a;var d;var c;var f=DH.Base.create({elements:{".j-current":"elCurrent",".j-list":"elList"},events:{"click .j-left":"goLeft","click .j-right":"goRight","click .j-item":"clickItem","click .j-btn-confirm":"confirm","click .j-btn-cancel":"cancel"},tpl:{item:'<li data-url="<%=url%>" data-big="<%=big%>" data-mini="<%=mini%>" data-md5="<%=md5%>" class="j-item"><span><img width="36" height="33" src="<%=mini%>"></span></li>'},init:function(){this.$locationList=null;this.$currentItem=null;this.currentIndex=0;this.scrollNum=6;this.totalNum=0;this.step=0},resetData:function(){var i=this,l=this.$locationList,k=this.elList,h=this.tmpl,j=this.tpl,g;this.totalNum=0;k.empty();l.each(function(){var m=e(this).find('input[name="inp_imgurl"]').val(),n=e(this).find('input[name="inp_imgmd5"]').val();k.append(h(j.item,{url:m,big:DHDealImage.get0x0(m),mini:DHDealImage.getThumbnails(m),md5:n}));i.totalNum++});g=this.$currentItem=k.find(".j-item").eq(0);g.addClass("current");this.showCurrent(g.attr("data-big"));this.step=g.outerWidth(true)},goLeft:function(g){if(this.totalNum<=this.scrollNum){return}if(this.currentIndex===0){return}this.currentIndex--;this.elList.css({marginLeft:-(this.currentIndex*this.step)})},goRight:function(g){if(this.totalNum<=this.scrollNum){return}if(this.currentIndex===this.totalNum-this.scrollNum){return}this.currentIndex++;this.elList.css({marginLeft:-(this.currentIndex*this.step)})},clickItem:function(i){var h=e(i.currentTarget),g=h.attr("data-url"),j=h.attr("data-big");if(h.hasClass("current")){return}this.showCurrent(j);h.addClass("current");this.$currentItem.removeClass("current");this.$currentItem=h},showCurrent:function(g){this.elCurrent.find("img").attr("src",g)},confirm:function(){var g=this.$currentItem,h=g.attr("data-url"),j=g.attr("data-mini"),i=g.attr("data-md5");a.hide();this.trigger("confirm",{url:h,src:j,md5:i})},cancel:function(){a.hide()}});var b=DH.Base.create({elements:{".j-title":"elTitle",".j-current-pic":"elCurrentPic",".j-error-tip":"elErr",".j-input-googleshoppingimagelist":"elImageList",".j-enabled":"elEnabled",".j-disabled":"elDisabled"},events:{"click .j-btn-showpic":"showPic","click .j-btn-showalbum":"showAlbum"},init:function(){this.isRequired=+e("#googleShoppingRequired").val()===1;this.showRequired();if(this.initEdit()){return}c=new f({el:".j-dialog-googleshopping-pic"}).bind("confirm",this.proxy(this.selectPic));a=new DH.Widget.Dialog().bind("show",function(){c.resetData()});d=new DH.Widget.Dialog();this.initControl();G_EVENT.bind("chkGoogleShoppingPic",this.proxy(this.chkPic));G_EVENT.bind("setGoogleShoppingPicFromAlbum",this.proxy(this.selectPicFromAlbum))},initEdit:function(){if(e.trim(this.elImageList.val())!==""){this.elEnabled.hide();this.elDisabled.show();return true}},showRequired:function(){if(this.isRequired){this.elTitle.html('<span class="required">*</span>'+this.elTitle.html())}},showPic:function(){if((c.$locationList=e("#div_imgcontainer").find(".syi-upload-list")).length===0){d.alert("还没有上传产品图片");return}a.html(".j-dialog-googleshopping-pic",{title:"产品图片预览"})},initControl:function(){var g=this;e("#fileupload_googleshopping").uploadify({uploader:"/syi/js/photo/upload2/uploadalbums.swf?v="+(new Date()).getTime(),script:"http://upload.dhgate.com/uploadfile",cancelImg:"/syi/js/photo/upload2/cancel.png",folder:"uploaddify",scriptAccess:"always",method:"GET",queueID:"googleshoppingPicQueue",auto:false,multi:true,queueSizeLimit:8,simUploadLimit:8,sizeLimit:2*1024*1024,hideButton:true,wmode:"transparent",width:72,height:23,fileExt:"*.jpg;*.JPG;*.jpeg;*.JPEG;",fileDesc:"choose *.jpg/",onInit:function(){},uploadifySettings:function(h){},onError:function(k,h,j,i){g.showErr("抱歉，图片上传失败，请稍后再试。");e("#fileupload_googleshopping").uploadifyCancel(h);return false},onOpen:function(j,h,i){},onSelect:function(l,h,k){g.hideErr();if(k.size>2*1024*1024){g.showErr("您选取的图片中有大于2M的图片");return false}if((k.type).toLowerCase()==".jpg"||(k.type).toLowerCase()==".jpeg"){var n=e("#functionname").val();var m=e("#supplierid").val();var j=e("#imagebannername").val();var i=e("#imgtoken").val();e("#fileupload_googleshopping").uploadifySettings("scriptData",{functionname:n,supplierid:m,imagebannername:j,token:i});e("#fileupload_googleshopping").uploadifyUpload()}else{g.showErr("您选取的图片中有非jpg格式的图片");return false}},onQueueFull:function(h,i){return false},onSelectOnce:function(){},onComplete:function(k,h,j,i,l){if(i&&(i=e.parseJSON(i))){g.selectPic({url:i.l_imgurl,src:DHDealImage.getThumbnails(i.l_imgurl),md5:i.l_imgmd5})}else{g.showErr("抱歉，图片上传失败，请稍后再试。");e("#fileupload_googleshopping").uploadifyCancel(h)}},onAllComplete:function(k,i,j,h,l){}})},selectPic:function(g){var h={"class":"com.dhgate.syi.model.TdProductAttachVO",type:"3",fileurl:g.url,imgmd5:g.md5};this.elCurrentPic.html('<img src="'+g.src+'" />');this.elImageList.val(JSON.stringify(h));this.hideErr()},selectPicFromAlbum:function(h,g){if(+g.searchtype===4){this.selectPic(g)}},chkPic:function(){var g=this.isRequired,h=this.elImageList.val();if(g&&h===""){this.showErr("请选择站内外推广图片")}else{this.hideErr()}},showAlbum:function(){showAlbumImgList_syi("4")},showErr:function(g){this.elErr.addClass("error-text").show().html(g);showErrorTip("googleshopping","站内外推广图片错误")},hideErr:function(){this.elErr.removeClass("error-text").hide()}});new b({el:".j-googleshopping-container"})})(window.jQuery);(function(b){var a=DH.Base.create({elements:{".j-code":"elCode",".j-code-img":"elCodeImg",".j-error-tip":"elErr"},events:{"keyup .j-code":"keyupCode","blur .j-code":"chkCode","click .j-change-code":"clickChangeCode"},cgi:{getCode:"http://seller.dhgate.com/syi/verifycode.jsp",requireCode:"/syi/ajaxVerifyCode.do"},init:function(){this.cache={};this.getCode();G_EVENT.bind("chkValidateCode",this.proxy(this.chkCode))},getCode:function(){this.elCodeImg.attr("src",this.cgi.getCode+"?temp="+(new Date-0))},keyupCode:function(d){var c=b(d.currentTarget),f=b.trim(c.val());f.length===4&&this.chkCode()},clickChangeCode:function(){delete this.cache.code;this.elCode.val("").focus();this.getCode();return false},chkCode:function(){var d=this.elCode,c=this.cache.code||(this.cache.code={}),f=b.trim(d.val()),e;d.val(f);if(f===c.value){if(c.err){this.showErr(c.err);return false}else{if(c.load){return false}}}if(f===""){e="验证码不能为空"}else{if(f.length!==4){e="验证码填写错误"}}if(e){this.showErr(e);return false}else{if(f!==c.value){c.value=f;this.requireCode(f);c.load=true;return false}else{this.hideErr();return true}}},requireCode:function(c){var d={};b.extend(d,{code:c,_:new Date-0});b.get(this.cgi.requireCode,d,this.proxy(this.requireCodeBack))},requireCodeBack:function(c){if(c){var d=this.cache.code;delete d.load;if(+c.code===1000){delete d.err}else{d.err="验证码填写错误"}this.chkCode()}else{}},showErr:function(c){this.elErr.addClass("error-text").show().html(c);showErrorTip("validatecode","验证码错误")},hideErr:function(){this.elErr.removeClass("error-text").hide()}});b(".j-validatecode-container").length&&b(".j-validatecode-container").is(":visible")&&(new a({el:".j-validatecode-container"}))})(window.jQuery);(function(c){var b=new DH.Widget.Dialog();var a=DH.Base.create({events:{"click .j-wedbox":"fnWedBox","click .j-sethtmldesc":"fnSetHTMLDescription","click input[name=refundDays]":"fnClickInputRefundDays","focus #outer_Description":"fnFocusOuterDescription","blur #outer_Description":"fnBlurOuterDescription","focus #outer_returndays":"fnFocusOuterReturndays","blur #outer_returndays":"fnBlurOuterReturndays"},cgi:{getWedBox:"/syi/productmodel.do?isblank=true",desc:"请在此处输入您的产品详细描述信息，记得用英文哦^_^",returndays:"请输入您的退换货天数"},msg:{showhtmlmodel_html:"温馨提示：",setHTMLDescription_html1:"请输入",setHTMLDescription_html2:"数据错误"},init:function(){var d=this,e=this.el;c(function(){d.$i=e.find(".j-weddingtemp .choiceTag");d.prevTpl=c("#weddingtempid").val()||"";d.catepubid=c("#inp_catepubid").val()});this.wedTplsCache={};this.wedTplsDataCache={}},fnWedBox:function(h){var g=this,i=c(h.currentTarget),d=i.attr("data-wb")||"",f=this.prevTpl;this.prevTpl=d;this.$curWedbox=i;if(!d){if(!f){c.pub("setContent.edite","");c("#weddingtempid").val("");return false}b.confirm("空白模板中会清空产品详细描述所有内容，确定选择空白模板？",{btns:[{text:"确定",className:"yellowBtn valmiddle",fn:function(){b.hide();g.setChoiceTag();c.pub("setContent.edite","");g.prevTpl="";c("#weddingtempid").val("")}},{text:"取消",className:"tourBtn",fn:function(){b.hide()}}],hide:function(){g.prevTpl=f}});return false}var j=this.wedTplsCache[d];if(j){this.showhtmlmodel(d,"elm")}else{this.getHtmlModel(d,"elm")}return false},fnClickInputRefundDays:function(g){var f=+c(g.target).val(),d=c("#outer_returndays").val();if(f===0&&d!==this.cgi.returndays){c("#outer_returndays").val(this.cgi.returndays).addClass("helptips");this.wedTplsDataCache.radio=""}},fnFocusOuterDescription:function(g){var d=this,h=c(g.target),f=h.val();if(f===d.cgi.desc){h.val("").removeClass("helptips")}},fnBlurOuterDescription:function(g){var d=this,h=c(g.target),f=h.val();if(!f){h.val(d.cgi.desc).addClass("helptips")}},fnFocusOuterReturndays:function(g){var d=this,h=c(g.target),f=h.val();if(f===d.cgi.returndays){h.val("").removeClass("helptips")}},fnBlurOuterReturndays:function(g){var d=this,h=c(g.target),f=h.val();if(!f){h.val(d.cgi.returndays).addClass("helptips")}},setChoiceTag:function(){var d=this.$curWedbox;if(d.length){d.append(this.$i)}},getHtmlModel:function(d,h,f){var e=this;f||(f="1");var g="mid="+d+"&type="+f+"&catepubid="+e.catepubid;c.ajax({type:"POST",url:e.cgi.getWedBox,data:g,success:function(i){if(i.result=="1"){e.wedTplsCache[d]=i;e.showhtmlmodel(d,h,f)}},async:true,dataType:"json",error:function(){console.log(["获取婚纱模板数据失败"])}})},showhtmlmodel:function(d,g,f){var e=this;f||(f="1");var i=e.wedTplsCache[d];if(!i||!i.content.length){return}var h=e.wedTplsDataCache||{};if(h.Description){c("#outer_Description").val(h.Description).removeClass("helptips")}else{c("#outer_Description").val(e.cgi.desc).addClass("helptips")}if(c("#outer_returndays").val()===e.cgi.returndays){c("#outer_returndays").addClass("helptips")}if(h.returndays&&+h.radio===1){c("#outer_returndays").val(h.returndays).removeClass("helptips");if(h.returndays===e.cgi.returndays){c("#outer_returndays").addClass("helptips")}}if(+h.radio===0||+h.radio===1){c("input[name=refundDays][value="+h.radio+"]").attr("checked",true);if(+h.radio===0){c("#outer_returndays").val(e.cgi.returndays).addClass("helptips")}}c("#h_htmlmodel_id").val(d);c("#outer_DescriptionTip").hide();c("#outer_returndaysTip").hide();c("#div_htmltemp").modal({close:false})},fnSetHTMLDescription:function(){var l=this,h=c("#h_htmlmodel_id").val();var e=l.wedTplsCache[h];if(!e||!e.content.length){return}var j={},f=c("#outer_Description").val(),i=c("#outer_returndays").val(),g=+c("input[name=refundDays]:checked").val(),k=e.content.replace(/&quot;/g,'"');var d=true;c("#outer_DescriptionTip").hide();c("#outer_returndaysTip").hide();if(f.length){if(f===l.cgi.desc){f=""}else{if(!checkValidEnglish(c("#outer_Description")[0])){c("#outer_DescriptionTip").html("描述中不能包含有中文").show();d=false}}k=k.replace(("$$Description$$"),f)}else{f=""}if(g===0){k=k.replace(("$$display$$"),"").replace(("$$display2$$"),"none")}else{if(i===l.cgi.returndays){i=""}if(!i.length){c("#outer_returndaysTip").html("请输入退换货天数").show();d=false}if(isNaN(i)||!/^\d+$/.test(i)){c("#outer_returndaysTip").html("请输入正确退换货天数").show();d=false}k=k.replace(("$$display$$"),"none").replace(("$$display2$$"),"").replace(("$$returndays$$"),i)}if(!d){return false}j.Description=f;j.returndays=i;j.radio=g;l.wedTplsDataCache=j;k=k.replace(/&lt;/g,"<").replace(/&gt;/g,">");c.pub("setContent.edite",k);jQuery.modal.close();l.setChoiceTag();c("#weddingtempid").val(h);return false}});new a({el:"body"})})(window.jQuery);(function(b){var a=DH.Base.create({elements:{".j-shippingarea-tip":"elTip",".j-shippingarea-trigger":"elTrigger"},events:{"mouseenter .j-shippingarea-trigger":"enter","mouseleave .j-shippingarea-trigger":"leave","click .j-shippingarea-trigger":"returnFalse"},init:function(){b(function(c){return function(){c.tipHeight=c.elTip.outerHeight(true);c.tipWidth=c.elTip.outerWidth(true)}}(this))},enter:function(){this.elTip.show().css({left:this.elTrigger.position().left-this.tipWidth/2+35,bottom:this.tipHeight+20})},leave:function(){this.elTip.hide()},returnFalse:function(){return false}});new a({el:".j-shippingarea-container"})})(window.jQuery);